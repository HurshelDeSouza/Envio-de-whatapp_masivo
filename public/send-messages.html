<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enviar Mensajes - WhatsApp Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        /* Asegurar que los emojis se muestren correctamente */
        .emoji, [id*="flag"], [id*="country"] {
            font-family: 'Segoe UI Emoji', 'Apple Color Emoji', 'Noto Color Emoji', 'Android Emoji', 'EmojiSymbols', sans-serif !important;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #333;
            font-size: 1.8em;
        }

        .btn-back {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .main-content {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .tabs-container {
            display: flex;
            background: #f3f4f6;
            border-bottom: 2px solid #e5e7eb;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab:hover {
            background: #e5e7eb;
            color: #333;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: bold;
        }

        .form-group select,
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1em;
        }

        .form-group textarea {
            min-height: 150px;
            resize: vertical;
            font-family: inherit;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
        }

        .number-input {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .number-input input {
            flex: 1;
        }

        .number-input span {
            color: #666;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.6);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }

        .template-list {
            max-height: 300px;
            overflow-y: auto;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 10px;
        }

        .template-item {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
            cursor: pointer;
            transition: background 0.2s;
        }

        .template-item:hover {
            background: #f3f4f6;
        }

        .template-item:last-child {
            border-bottom: none;
        }

        .template-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .template-preview {
            color: #666;
            font-size: 0.9em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-weight: bold;
            display: none;
        }

        .status-message.success {
            background: #d1fae5;
            color: #065f46;
            display: block;
        }

        .status-message.error {
            background: #fee2e2;
            color: #991b1b;
            display: block;
        }

        .status-message.info {
            background: #dbeafe;
            color: #1e40af;
            display: block;
        }

        .campaign-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .campaign-controls button {
            flex: 1;
        }

        .btn-pause {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .btn-stop {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .options-section {
            border-top: 2px solid #e5e7eb;
            padding-top: 20px;
            margin-top: 20px;
        }

        .options-section h3 {
            color: #333;
            margin-bottom: 15px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* Estilos personalizados para el slider */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            height: 18px;
            border-radius: 10px;
            outline: none;
            background: transparent;
            padding: 4px 0;
        }

        /* Track para WebKit (Chrome, Safari, Edge) */
        input[type="range"]::-webkit-slider-runnable-track {
            height: 18px;
            border-radius: 10px;
        }

        /* Thumb para WebKit */
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #10b981;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: all 0.2s ease;
            margin-top: 0px;
            position: relative;
            z-index: 2;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
        }

        input[type="range"]::-webkit-slider-thumb:active {
            transform: scale(1.1);
        }

        /* Track para Firefox */
        input[type="range"]::-moz-range-track {
            height: 18px;
            border-radius: 10px;
            background: #e5e7eb;
        }

        /* Thumb para Firefox */
        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #10b981;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: all 0.2s ease;
        }

        input[type="range"]::-moz-range-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
        }

        input[type="range"]::-moz-range-thumb:active {
            transform: scale(1.1);
        }

        /* Progress para Firefox */
        input[type="range"]::-moz-range-progress {
            background: #10b981;
            height: 18px;
            border-radius: 10px;
        }

        /* Mantener las flechitas de los inputs num√©ricos */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header" id="page-header">
            <h1>üì§ Enviar Mensajes Masivos</h1>
            <button class="btn-back" id="back-button" onclick="goBack()">‚Üê Volver al Dashboard</button>
        </div>

        <div class="main-content">
            <!-- Tabs -->
            <div class="tabs-container">
                <div class="tab active" onclick="switchTab('config')">
                    üìù Configurar Mensaje
                </div>
                <div class="tab" onclick="switchTab('stats')">
                    üìä Estad√≠sticas
                </div>
            </div>

            <!-- Tab Content: Configurar Mensaje -->
            <div id="tab-config" class="tab-content active">
                <h2>Configurar Mensaje</h2>

                <!-- Radio Buttons para seleccionar modo -->
                <div style="display: flex; gap: 30px; margin-bottom: 30px; padding: 20px; background: #f9fafb; border-radius: 10px;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 1.1em; font-weight: bold;">
                        <input type="radio" name="send-mode" value="numbers" onchange="changeSendMode('numbers')">
                        üì± Numbers
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 1.1em; font-weight: bold;">
                        <input type="radio" name="send-mode" value="groups" checked onchange="changeSendMode('groups')">
                        üë• Groups
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 1.1em; font-weight: bold;">
                        <input type="radio" name="send-mode" value="contacts" onchange="changeSendMode('contacts')">
                        üìá Contacts
                    </label>
                </div>

                <!-- Secci√≥n para Numbers -->
                <div id="section-numbers" style="display: none;">
                    <!-- Layout de dos columnas -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        
                        <!-- COLUMNA IZQUIERDA -->
                        <div>
                            <div class="form-group">
                                <label>Ingrese n√∫meros para enviar mensajes</label>
                                
                            <!-- √Årea de contenido con tags de n√∫meros -->
                            <div style="padding: 15px;">
                                <!-- Contenedor √∫nico con selector de pa√≠s, tags, textarea y botones -->
                                <div style="border: 2px solid #d1d5db; border-radius: 10px; background: white; padding: 15px; min-height: 150px; position: relative;">
                                    <!-- Selector de pa√≠s dentro del contenedor -->
                                    <div style="position: relative; display: inline-block; margin-bottom: 10px;">
                                        <div id="country-selector-btn" onclick="toggleCountryDropdown()" style="padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 0.95em;">
                                            <img id="selected-flag-img" src="https://flagcdn.com/w40/ca.png" alt="CA" style="width: 26px; height: 18px; border-radius: 2px; object-fit: cover; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                                            <span id="selected-code" style="color: #10b981; font-weight: bold;">+1</span>
                                            <span style="margin-left: 5px; color: #666; font-size: 0.8em;">‚ñº</span>
                                        </div>
                                        
                                        <!-- Dropdown de pa√≠ses -->
                                        <div id="country-dropdown" style="display: none; position: absolute; top: 100%; left: 0; width: 320px; background: white; border: 2px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); margin-top: 5px; z-index: 1000; max-height: 400px; overflow: hidden;">
                                            <!-- Barra de b√∫squeda -->
                                            <div style="padding: 10px; border-bottom: 1px solid #e5e7eb; background: #f9fafb;">
                                                <input type="text" id="country-search" placeholder="üîç Buscar pa√≠s..." style="width: 100%; padding: 8px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 0.9em;" oninput="filterCountries()" onclick="event.stopPropagation()">
                                            </div>
                                            
                                            <!-- Lista de pa√≠ses -->
                                            <div id="countries-list" style="max-height: 350px; overflow-y: auto;">
                                                <!-- Los pa√≠ses se cargar√°n aqu√≠ -->
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Contenedor de n√∫meros seleccionados como tags -->
                                    <div id="numbers-selected-tags" style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 10px;">
                                        <!-- Los tags se agregar√°n aqu√≠ din√°micamente -->
                                    </div>
                                    
                                    <!-- Textarea para agregar n√∫meros -->
                                    <textarea id="numbers-input" placeholder="Escriba un n√∫mero y presione Enter..." style="width: 100%; min-height: 80px; font-family: monospace; padding: 0; border: none; font-size: 0.95em; resize: none; outline: none; background: transparent; margin-bottom: 15px;" onkeydown="handleNumberInput(event)"></textarea>
                                    
                                    <!-- Botones dentro del contenedor -->
                                    <div style="display: flex; gap: 10px; align-items: center; justify-content: space-between; padding-top: 15px; border-top: 1px solid #e5e7eb;">
                                        <button onclick="showExampleNumbers()" style="display: flex; align-items: center; gap: 5px; padding: 8px 16px; background: white; border: 2px solid #10b981; color: #10b981; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9em;">
                                            üìã Ejemplo
                                        </button>
                                        
                                        <div style="display: flex; gap: 10px;">
                                            <button onclick="uploadNumbersFile()" style="display: flex; align-items: center; gap: 5px; padding: 8px 16px; background: white; border: 2px solid #10b981; color: #10b981; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9em;">
                                                üì§ Subir Excel
                                            </button>
                                            
                                            <div style="position: relative;">
                                                <button onclick="toggleCampaignNumbersMenu()" id="campaign-numbers-btn" style="padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; cursor: pointer; font-size: 0.9em; min-width: 180px; color: #666; display: flex; align-items: center; justify-content: space-between; gap: 8px;">
                                                    <span>Campaign Numbers</span>
                                                    <span style="font-size: 0.8em;">‚ñº</span>
                                                </button>
                                                
                                                <!-- Men√∫ desplegable de Campaign Numbers -->
                                                <div id="campaign-numbers-dropdown" style="display: none; position: absolute; bottom: 100%; right: 0; background: white; border: 2px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 250px; margin-bottom: 5px; z-index: 1000;">
                                                    <div style="padding: 15px; color: #9ca3af; text-align: center; border-bottom: 1px solid #e5e7eb; font-size: 1.1em;">
                                                        ¬°Nada que mostrar!
                                                    </div>
                                                    <div onclick="showAddCampaignNumberModal()" style="padding: 12px 15px; cursor: pointer; display: flex; align-items: center; gap: 8px; color: #10b981; font-weight: bold; transition: background 0.2s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='white'">
                                                        üìã <span style="color: #10b981;">Add Template</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                        </div>
                    </div>

                    <!-- √Årea de mensaje con opciones de formato -->
                    <div class="form-group" style="margin-top: 20px;">
                        <label>Introducir mensaje</label>
                        <div style="border: 2px solid #e5e7eb; border-radius: 8px; overflow: hidden;">
                            <!-- Barra de formato -->
                            <div style="background: #f9fafb; padding: 8px; border-bottom: 1px solid #e5e7eb; display: flex; gap: 10px; align-items: center;">
                                <button onclick="formatText('bold')" style="padding: 5px 10px; border: 1px solid #e5e7eb; background: white; border-radius: 4px; cursor: pointer; font-weight: bold;">*text*</button>
                                <button onclick="formatText('italic')" style="padding: 5px 10px; border: 1px solid #e5e7eb; background: white; border-radius: 4px; cursor: pointer; font-style: italic;">_text_</button>
                                <button onclick="formatText('strike')" style="padding: 5px 10px; border: 1px solid #e5e7eb; background: white; border-radius: 4px; cursor: pointer; text-decoration: line-through;">~text~</button>
                                <button onclick="formatText('code')" style="padding: 5px 10px; border: 1px solid #e5e7eb; background: white; border-radius: 4px; cursor: pointer; font-family: monospace;">`text`</button>
                                <span style="color: #999; margin-left: auto;">EMOJIS</span>
                            </div>
                            
                            <!-- √Årea de texto -->
                            <textarea id="message-numbers" placeholder="Escribe tu mensaje aqu√≠..." style="width: 100%; min-height: 150px; border: none; padding: 15px; font-size: 1em; resize: vertical; font-family: inherit;"></textarea>
                            
                            <!-- Barra inferior con clip y template -->
                            <div style="background: #f9fafb; padding: 10px; border-top: 1px solid #e5e7eb; display: flex; gap: 10px; align-items: center;">
                                <button onclick="attachFile()" style="padding: 8px 15px; border: 1px solid #e5e7eb; background: white; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 5px;">
                                    üìé
                                </button>
                                
                                <div style="position: relative;">
                                    <button onclick="toggleTemplateMenu()" id="template-btn" style="padding: 8px 15px; border: 1px solid #e5e7eb; background: white; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 5px;">
                                        Template ‚ñº
                                    </button>
                                    
                                    <!-- Men√∫ desplegable de templates -->
                                    <div id="template-dropdown" style="display: none; position: absolute; bottom: 100%; left: 0; background: white; border: 2px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 200px; margin-bottom: 5px; z-index: 1000;">
                                        <div style="padding: 10px; color: #666; text-align: center; border-bottom: 1px solid #e5e7eb;">
                                            ¬°Nada que mostrar!
                                        </div>
                                        <div onclick="showAddTemplateModal()" style="padding: 12px; cursor: pointer; display: flex; align-items: center; gap: 8px; color: #10b981; font-weight: bold; transition: background 0.2s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='white'">
                                            üìã Add Template
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bot√≥n Enviar Mensajes -->
                    <button class="btn-primary" onclick="sendCampaign()" style="width: 100%; margin-top: 20px;">
                        üì§ Enviar Mensajes
                    </button>
                    
                    <div class="campaign-controls" id="campaign-controls" style="display: none; margin-top: 10px;">
                        <button class="btn-primary btn-pause" onclick="pauseCampaign()" style="width: 100%; margin-bottom: 10px;">‚è∏Ô∏è Pausar</button>
                        <button class="btn-primary btn-stop" onclick="stopCampaign()" style="width: 100%;">üõë Detener</button>
                    </div>
                    
                    <div id="status-message" class="status-message"></div>
                    </div>
                    
                    <!-- COLUMNA DERECHA - Opciones Avanzadas -->
                    <div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 15px;">
                                <span style="font-size: 1.2em;">‚öôÔ∏è</span>
                                <span style="font-weight: bold; font-size: 1.1em;">Opciones Avanzadas</span>
                            </label>
                            
                            <div style="border: 2px solid #e5e7eb; border-radius: 10px; padding: 20px; background: white;">
                                
                                <!-- Agregar intervalos de tiempo -->
                                <div style="margin-bottom: 20px;">
                                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 15px; cursor: pointer;">
                                        <input type="checkbox" id="enable-delays" onchange="toggleDelayOptions()" style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981; flex-shrink: 0;">
                                        <span style="font-weight: 600; color: #333; font-size: 1.05em;">Agregar un intervalo de tiempo entre mensajes</span>
                                    </label>
                                    
                                    <div id="delay-options" style="margin-top: 15px; display: none; padding: 15px; background: #f9fafb; border-radius: 8px;">
                                        <!-- Opci√≥n con Slider -->
                                        <div style="margin-bottom: 20px;">
                                            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer;">
                                                <input type="radio" name="delay-mode" value="slider" checked onchange="toggleDelayMode()" style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981;">
                                                <span style="font-weight: 500; color: #333;">Fijo</span>
                                            </label>
                                            
                                            <div id="slider-option" style="display: flex; align-items: center; gap: 15px; padding-left: 28px; padding-top: 10px; padding-bottom: 10px;">
                                                <input type="range" id="delay-slider" min="1" max="60" value="3" step="1" oninput="updateSliderValue()" style="flex: 1; background: linear-gradient(to right, #10b981 0%, #10b981 5%, #e5e7eb 5%, #e5e7eb 100%);">
                                                <input type="number" id="delay-slider-value" value="3" min="1" max="60" step="1" oninput="updateSliderFromInput()" style="width: 80px; padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em; text-align: center;">
                                                <span style="color: #666; font-weight: 500;">sec</span>
                                            </div>
                                        </div>
                                        
                                        <!-- Opci√≥n Aleatorio -->
                                        <div style="margin-bottom: 20px;">
                                            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; cursor: pointer;">
                                                <input type="radio" name="delay-mode" value="random" onchange="toggleDelayMode()" style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981;">
                                                <span style="font-weight: 500; color: #333;">Aleatorio</span>
                                            </label>
                                        </div>
                                        
                                        <!-- Opci√≥n Personalizado aleatorio (Recomendado) -->
                                        <div>
                                            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer;">
                                                <input type="radio" name="delay-mode" value="custom" onchange="toggleDelayMode()" style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981;">
                                                <span style="font-weight: 500; color: #333;">Personalizado aleatorio <span style="color: #ef4444; font-weight: 600;">(Recomendado)</span></span>
                                                <span style="margin-left: auto; color: #9ca3af; cursor: help;" title="Esta opci√≥n var√≠a el tiempo entre mensajes de forma aleatoria para parecer m√°s natural">‚ùì</span>
                                            </label>
                                            
                                            <div id="custom-option" style="display: none; padding-left: 28px;">
                                                <div style="display: flex; gap: 10px; align-items: center;">
                                                    <span style="color: #666; font-weight: 500;">De:</span>
                                                    <input type="number" id="delay-min" value="5" min="1" max="60" step="1" style="flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em;">
                                                    <span style="color: #666; font-weight: 500;">A:</span>
                                                    <input type="number" id="delay-max" value="15" min="1" max="60" step="1" style="flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em;">
                                                    <span style="color: #666; font-weight: 500;">segundos</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Agregar lotes -->
                                <div style="margin-bottom: 20px;">
                                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px; cursor: pointer;">
                                        <input type="checkbox" id="enable-batches" onchange="toggleBatchOptions()" style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981; flex-shrink: 0;">
                                        <span style="font-weight: 600; color: #333; font-size: 1.05em;">Agregar lotes <span style="color: #10b981;">(Recomendado)</span></span>
                                    </label>
                                    
                                    <div id="batch-options" style="margin-top: 10px; display: none; padding: 15px; background: #f9fafb; border-radius: 8px;">
                                        <label style="display: block; color: #666; font-size: 0.9em; margin-bottom: 10px; font-weight: 500;">Enviar en lotes de</label>
                                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                                            <input type="range" id="batch-size-slider" min="10" max="50" value="50" step="1" oninput="updateBatchSizeValue()" style="flex: 1; background: linear-gradient(to right, #10b981 0%, #10b981 100%, #e5e7eb 100%, #e5e7eb 100%);">
                                            <input type="number" id="batch-size" value="50" min="10" max="50" step="1" oninput="updateBatchSizeFromInput()" style="width: 80px; padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em; text-align: center;">
                                            <span style="color: #666; font-weight: 500;">mensajes</span>
                                        </div>
                                        
                                        <label style="display: block; color: #666; font-size: 0.9em; margin-bottom: 10px; font-weight: 500;">Agregue un intervalo de tiempo en lotes en blanco y negro de</label>
                                        <div style="display: flex; align-items: center; gap: 15px;">
                                            <input type="range" id="batch-delay-slider" min="5" max="50" value="30" step="1" oninput="updateBatchDelayValue()" style="flex: 1; background: linear-gradient(to right, #10b981 0%, #10b981 56%, #e5e7eb 56%, #e5e7eb 100%);">
                                            <input type="number" id="batch-delay" value="30" min="5" max="50" step="1" oninput="updateBatchDelayFromInput()" style="width: 80px; padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em; text-align: center;">
                                            <span style="color: #666; font-weight: 500;">segundos</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Programe su campa√±a -->
                                <div style="margin-bottom: 20px;">
                                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px; cursor: pointer;">
                                        <input type="checkbox" id="enable-schedule" onchange="toggleScheduleOptions()" style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981; flex-shrink: 0;">
                                        <span style="font-weight: 600; color: #333; font-size: 1.05em;">Programe su campa√±a</span>
                                    </label>
                                    
                                    <div id="schedule-options" style="margin-top: 10px; display: none; padding: 15px; background: #f9fafb; border-radius: 8px;">
                                        <label style="display: block; color: #666; font-size: 0.9em; margin-bottom: 10px; font-weight: 500;">Fecha y hora de inicio</label>
                                        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                                            <input type="date" id="schedule-date" style="flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em;">
                                            <input type="time" id="schedule-time" style="flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em;">
                                        </div>
                                    </div>
                                    
                                    <!-- Botones de campa√±as -->
                                    <div style="margin-top: 15px; display: flex; flex-direction: column; gap: 10px;">
                                        <div style="position: relative;">
                                            <button onclick="toggleUpcomingCampaigns()" id="upcoming-campaigns-btn" style="width: 100%; padding: 12px 20px; background: white; border: 2px solid #10b981; color: #10b981; border-radius: 8px; font-weight: 600; font-size: 1em; cursor: pointer; display: flex; align-items: center; justify-content: space-between; transition: all 0.2s;" onmouseover="this.style.background='#f0fdf4'" onmouseout="this.style.background='white'">
                                                <span>Ver campa√±as programadas</span>
                                                <span style="font-size: 0.8em;">‚ñº</span>
                                            </button>
                                            
                                            <!-- Dropdown de campa√±as programadas -->
                                            <div id="upcoming-campaigns-dropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); margin-top: 5px; z-index: 1000; max-height: 300px; overflow-y: auto;">
                                                <div style="padding: 20px; color: #9ca3af; text-align: center; font-size: 0.95em;">
                                                    No hay campa√±as programadas
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div style="position: relative;">
                                            <button onclick="togglePausedCampaigns()" id="paused-campaigns-btn" style="width: 100%; padding: 12px 20px; background: white; border: 2px solid #10b981; color: #10b981; border-radius: 8px; font-weight: 600; font-size: 1em; cursor: pointer; display: flex; align-items: center; justify-content: space-between; transition: all 0.2s;" onmouseover="this.style.background='#f0fdf4'" onmouseout="this.style.background='white'">
                                                <span>Reanudar campa√±as pausadas</span>
                                                <span style="font-size: 0.8em;">‚ñº</span>
                                            </button>
                                            
                                            <!-- Dropdown de campa√±as pausadas -->
                                            <div id="paused-campaigns-dropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); margin-top: 5px; z-index: 1000; max-height: 300px; overflow-y: auto;">
                                                <div style="padding: 20px; color: #9ca3af; text-align: center; font-size: 0.95em;">
                                                    Sin campa√±as pausadas
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                    
                </div>
                </div>

                <!-- Modal: Add Template -->
                <div id="add-template-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center;">
                    <div style="background: #e0f2f1; padding: 30px; border-radius: 15px; max-width: 600px; width: 90%; position: relative;">
                        <button onclick="closeAddTemplateModal()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 2em; cursor: pointer; color: #333;">√ó</button>
                        
                        <h2 style="margin-bottom: 20px; color: #333;">Add Template</h2>
                        
                        <div style="margin-bottom: 20px;">
                            <textarea id="template-content" placeholder="Escribe tu plantilla aqu√≠..." style="width: 100%; min-height: 200px; padding: 15px; border: 2px solid #b2dfdb; border-radius: 8px; font-size: 1em; resize: vertical; font-family: inherit;"></textarea>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                            <label style="color: #333; font-weight: bold;">Save as</label>
                            <input type="text" id="template-name" placeholder="Nombre de la plantilla" style="flex: 1; padding: 12px; border: 2px solid #b2dfdb; border-radius: 8px; font-size: 1em;">
                        </div>
                        
                        <button onclick="saveTemplate()" style="background: #26a69a; color: white; border: none; padding: 15px 40px; border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer; width: 100%;">
                            Save Template
                        </button>
                    </div>
                </div>

                <!-- Modal: Add Campaign Numbers -->
                <div id="add-campaign-numbers-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center;">
                    <div style="background: #d1e7dd; padding: 30px; border-radius: 15px; max-width: 600px; width: 90%; position: relative;">
                        <button onclick="closeAddCampaignNumbersModal()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 2em; cursor: pointer; color: #333;">√ó</button>
                        
                        <h2 style="margin-bottom: 20px; color: #333;">Save Campaign Numbers</h2>
                        
                        <div style="margin-bottom: 20px;">
                            <textarea id="campaign-numbers-content" placeholder="Escribe tu plantilla aqu√≠..." style="width: 100%; min-height: 200px; padding: 15px; border: 2px solid #b8dac6; border-radius: 8px; font-size: 1em; resize: vertical; font-family: inherit; background: white;"></textarea>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                            <label style="color: #333; font-weight: bold;">Nombre de la campa√±a</label>
                            <input type="text" id="campaign-numbers-name" placeholder="Nombre de la campa√±a" style="flex: 1; padding: 12px; border: 2px solid #b8dac6; border-radius: 8px; font-size: 1em; background: white;">
                        </div>
                        
                        <button onclick="saveCampaignNumbers()" style="background: #26a69a; color: white; border: none; padding: 15px 40px; border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer; width: 100%;">
                            Save Campaign Numbers
                        </button>
                    </div>
                </div>

                <!-- Secci√≥n para Groups -->
                <div id="section-groups">
                    <!-- Layout de dos columnas -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        
                        <!-- COLUMNA IZQUIERDA -->
                        <div>
                            <div class="form-group">
                                <label style="font-weight: bold; font-size: 1.1em; margin-bottom: 10px; display: block;">Select groups to message</label>
                                
                                <!-- Campo clickeable para desplegar grupos -->
                                <div style="position: relative;">
                                    <div onclick="toggleGroupsDropdown()" id="groups-selector-btn" style="width: 100%; padding: 15px; border: 2px solid #d1d5db; border-radius: 10px; background: white; cursor: pointer; min-height: 120px; position: relative; padding-bottom: 60px;">
                                        <span id="groups-placeholder" style="color: #9ca3af; font-size: 1em;">Select groups from the dropdown . . .</span>
                                        
                                        <!-- Contenedor de grupos seleccionados como tags -->
                                        <div id="groups-selected-tags" style="display: none; flex-wrap: wrap; gap: 10px;">
                                            <!-- Los tags se agregar√°n aqu√≠ din√°micamente -->
                                        </div>
                                        
                                        <!-- Bot√≥n de basurero para eliminar todos -->
                                        <button id="clear-all-groups-btn" onclick="clearAllGroups(event)" style="display: none; position: absolute; top: 15px; right: 15px; background: #f3f4f6; border: 2px solid #e5e7eb; border-radius: 6px; padding: 8px; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#fee2e2'; this.style.borderColor='#fca5a5'" onmouseout="this.style.background='#f3f4f6'; this.style.borderColor='#e5e7eb'">
                                            üóëÔ∏è
                                        </button>
                                        
                                        <!-- Botones en la parte inferior derecha -->
                                        <div style="position: absolute; bottom: 15px; right: 15px; display: flex; gap: 10px; align-items: center;">
                                            <!-- Bot√≥n Campaign Groups -->
                                            <div style="position: relative;">
                                                <button onclick="toggleCampaignGroupsMenu(event)" id="campaign-groups-btn" style="padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; cursor: pointer; font-size: 0.9em; min-width: 180px; color: #666; display: flex; align-items: center; justify-content: space-between; gap: 8px;">
                                                    <span>Campaign Groups</span>
                                                    <span style="font-size: 0.8em;">‚ñº</span>
                                                </button>
                                                
                                                <!-- Men√∫ desplegable de Campaign Groups -->
                                                <div id="campaign-groups-dropdown" style="display: none; position: absolute; bottom: 100%; right: 0; background: white; border: 2px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 250px; margin-bottom: 5px; z-index: 1000;">
                                                    <div style="padding: 15px; color: #9ca3af; text-align: center; border-bottom: 1px solid #e5e7eb; font-size: 1.1em;">
                                                        ¬°Nada que mostrar!
                                                    </div>
                                                    <div onclick="showAddCampaignGroupModal()" style="padding: 12px 15px; cursor: pointer; display: flex; align-items: center; gap: 8px; color: #10b981; font-weight: bold; transition: background 0.2s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='white'">
                                                        üìã <span style="color: #10b981;">Add Template</span>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Bot√≥n de guardar (diskette) -->
                                            <button id="save-groups-btn" onclick="showAddCampaignGroupModal(event)" style="display: none; background: #10b981; border: none; border-radius: 6px; padding: 10px 12px; cursor: pointer; transition: all 0.2s; color: white; font-size: 1.2em;" onmouseover="this.style.background='#059669'" onmouseout="this.style.background='#10b981'" title="Guardar selecci√≥n">
                                                üíæ
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Dropdown de grupos -->
                                    <div id="groups-dropdown-menu" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); margin-top: 5px; z-index: 1000; max-height: 400px; overflow: hidden;">
                                        <!-- Barra de b√∫squeda -->
                                        <div style="padding: 15px; border-bottom: 1px solid #e5e7eb; background: #f9fafb;">
                                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                                <input type="text" id="search-groups" placeholder="üîç Buscar grupo por nombre" style="flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 0.95em;" oninput="filterGroups()" onclick="event.stopPropagation()">
                                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; white-space: nowrap; font-weight: 500;">
                                                    <input type="checkbox" id="select-all" onchange="toggleSelectAll()" style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981;">
                                                    Select All
                                                </label>
                                            </div>
                                        </div>
                                        
                                        <!-- Lista de grupos -->
                                        <div id="groups-list" style="max-height: 300px; overflow-y: auto; padding: 10px;">
                                            <p style="color: #666; text-align: center; padding: 20px;">Cargando grupos...</p>
                                        </div>
                                    </div>
                                </div>
                        </div>

                    <!-- √Årea de mensaje con opciones de formato -->
                    <div class="form-group" style="margin-top: 20px;">
                        <label>Introducir mensaje</label>
                        <div style="border: 2px solid #e5e7eb; border-radius: 8px; overflow: hidden;">
                            <!-- Barra de formato -->
                            <div style="background: #f9fafb; padding: 8px; border-bottom: 1px solid #e5e7eb; display: flex; gap: 10px; align-items: center;">
                                <button onclick="formatTextGroups('bold')" style="padding: 5px 10px; border: 1px solid #e5e7eb; background: white; border-radius: 4px; cursor: pointer; font-weight: bold;">*text*</button>
                                <button onclick="formatTextGroups('italic')" style="padding: 5px 10px; border: 1px solid #e5e7eb; background: white; border-radius: 4px; cursor: pointer; font-style: italic;">_text_</button>
                                <button onclick="formatTextGroups('strike')" style="padding: 5px 10px; border: 1px solid #e5e7eb; background: white; border-radius: 4px; cursor: pointer; text-decoration: line-through;">~text~</button>
                                <button onclick="formatTextGroups('code')" style="padding: 5px 10px; border: 1px solid #e5e7eb; background: white; border-radius: 4px; cursor: pointer; font-family: monospace;">`text`</button>
                                <span style="color: #999; margin-left: auto;">EMOJIS</span>
                            </div>
                            
                            <!-- √Årea de texto -->
                            <textarea id="message-groups" placeholder="Escribe tu mensaje aqu√≠..." style="width: 100%; min-height: 150px; border: none; padding: 15px; font-size: 1em; resize: vertical; font-family: inherit;"></textarea>
                            
                            <!-- Barra inferior con clip y template -->
                            <div style="background: #f9fafb; padding: 10px; border-top: 1px solid #e5e7eb; display: flex; gap: 10px; align-items: center;">
                                <button onclick="attachFileGroups()" style="padding: 8px 15px; border: 1px solid #e5e7eb; background: white; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 5px;">
                                    üìé
                                </button>
                                
                                <div style="position: relative;">
                                    <button onclick="toggleTemplateMenuGroups()" id="template-groups-btn" style="padding: 8px 15px; border: 1px solid #e5e7eb; background: white; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 5px;">
                                        Template ‚ñº
                                    </button>
                                    
                                    <!-- Men√∫ desplegable de templates -->
                                    <div id="template-groups-dropdown" style="display: none; position: absolute; bottom: 100%; left: 0; background: white; border: 2px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 200px; margin-bottom: 5px; z-index: 1000;">
                                        <div style="padding: 10px; color: #666; text-align: center; border-bottom: 1px solid #e5e7eb;">
                                            ¬°Nada que mostrar!
                                        </div>
                                        <div onclick="showAddTemplateModalGroups()" style="padding: 12px; cursor: pointer; display: flex; align-items: center; gap: 8px; color: #10b981; font-weight: bold; transition: background 0.2s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='white'">
                                            üìã Add Template
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bot√≥n Enviar Mensajes -->
                    <button class="btn-primary" onclick="sendCampaignGroups()" style="width: 100%; margin-top: 20px;">
                        üì§ Enviar Mensajes
                    </button>
                    
                    <div class="campaign-controls" id="campaign-controls-groups" style="display: none; margin-top: 10px;">
                        <button class="btn-primary btn-pause" onclick="pauseCampaignGroups()" style="width: 100%; margin-bottom: 10px;">‚è∏Ô∏è Pausar</button>
                        <button class="btn-primary btn-stop" onclick="stopCampaignGroups()" style="width: 100%;">üõë Detener</button>
                    </div>
                    
                    <div id="status-message-groups" class="status-message"></div>
                    </div>
                    
                    <!-- COLUMNA DERECHA - Opciones Avanzadas -->
                    <div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 15px;">
                                <span style="font-size: 1.2em;">‚öôÔ∏è</span>
                                <span style="font-weight: bold; font-size: 1.1em;">Opciones Avanzadas</span>
                            </label>
                            
                            <div style="border: 2px solid #e5e7eb; border-radius: 10px; padding: 20px; background: white;">
                                
                                <!-- Agregar intervalos de tiempo -->
                                <div style="margin-bottom: 20px;">
                                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 15px; cursor: pointer;">
                                        <input type="checkbox" id="enable-delays-groups" onchange="toggleDelayOptionsGroups()" style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981; flex-shrink: 0;">
                                        <span style="font-weight: 600; color: #333; font-size: 1.05em;">Agregar un intervalo de tiempo entre mensajes</span>
                                    </label>
                                    
                                    <div id="delay-options-groups" style="margin-top: 15px; display: none; padding: 15px; background: #f9fafb; border-radius: 8px;">
                                        <!-- Opci√≥n con Slider -->
                                        <div style="margin-bottom: 20px;">
                                            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer;">
                                                <input type="radio" name="delay-mode-groups" value="slider" checked onchange="toggleDelayModeGroups()" style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981;">
                                                <span style="font-weight: 500; color: #333;">Fijo</span>
                                            </label>
                                            
                                            <div id="slider-option-groups" style="display: flex; align-items: center; gap: 15px; padding-left: 28px; padding-top: 10px; padding-bottom: 10px;">
                                                <input type="range" id="delay-slider-groups" min="1" max="60" value="3" step="1" oninput="updateSliderValueGroups()" style="flex: 1; background: linear-gradient(to right, #10b981 0%, #10b981 5%, #e5e7eb 5%, #e5e7eb 100%);">
                                                <input type="number" id="delay-slider-value-groups" value="3" min="1" max="60" step="1" oninput="updateSliderFromInputGroups()" style="width: 80px; padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em; text-align: center;">
                                                <span style="color: #666; font-weight: 500;">sec</span>
                                            </div>
                                        </div>
                                        
                                        <!-- Opci√≥n Aleatorio -->
                                        <div style="margin-bottom: 20px;">
                                            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; cursor: pointer;">
                                                <input type="radio" name="delay-mode-groups" value="random" onchange="toggleDelayModeGroups()" style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981;">
                                                <span style="font-weight: 500; color: #333;">Aleatorio</span>
                                            </label>
                                        </div>
                                        
                                        <!-- Opci√≥n Personalizado aleatorio (Recomendado) -->
                                        <div>
                                            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer;">
                                                <input type="radio" name="delay-mode-groups" value="custom" onchange="toggleDelayModeGroups()" style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981;">
                                                <span style="font-weight: 500; color: #333;">Personalizado aleatorio <span style="color: #ef4444; font-weight: 600;">(Recomendado)</span></span>
                                                <span style="margin-left: auto; color: #9ca3af; cursor: help;" title="Esta opci√≥n var√≠a el tiempo entre mensajes de forma aleatoria para parecer m√°s natural">‚ùì</span>
                                            </label>
                                            
                                            <div id="custom-option-groups" style="display: none; padding-left: 28px;">
                                                <div style="display: flex; gap: 10px; align-items: center;">
                                                    <span style="color: #666; font-weight: 500;">De:</span>
                                                    <input type="number" id="delay-min-groups" value="5" min="1" max="60" step="1" style="flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em;">
                                                    <span style="color: #666; font-weight: 500;">A:</span>
                                                    <input type="number" id="delay-max-groups" value="15" min="1" max="60" step="1" style="flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em;">
                                                    <span style="color: #666; font-weight: 500;">segundos</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Agregar lotes -->
                                <div style="margin-bottom: 20px;">
                                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px; cursor: pointer;">
                                        <input type="checkbox" id="enable-batches-groups" onchange="toggleBatchOptionsGroups()" style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981; flex-shrink: 0;">
                                        <span style="font-weight: 600; color: #333; font-size: 1.05em;">Agregar lotes <span style="color: #10b981;">(Recomendado)</span></span>
                                    </label>
                                    
                                    <div id="batch-options-groups" style="margin-top: 10px; display: none; padding: 15px; background: #f9fafb; border-radius: 8px;">
                                        <label style="display: block; color: #666; font-size: 0.9em; margin-bottom: 10px; font-weight: 500;">Enviar en lotes de</label>
                                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                                            <input type="range" id="batch-size-slider-groups" min="10" max="50" value="50" step="1" oninput="updateBatchSizeValueGroups()" style="flex: 1; background: linear-gradient(to right, #10b981 0%, #10b981 100%, #e5e7eb 100%, #e5e7eb 100%);">
                                            <input type="number" id="batch-size-groups" value="50" min="10" max="50" step="1" oninput="updateBatchSizeFromInputGroups()" style="width: 80px; padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em; text-align: center;">
                                            <span style="color: #666; font-weight: 500;">mensajes</span>
                                        </div>
                                        
                                        <label style="display: block; color: #666; font-size: 0.9em; margin-bottom: 10px; font-weight: 500;">Agregue un intervalo de tiempo en lotes en blanco y negro de</label>
                                        <div style="display: flex; align-items: center; gap: 15px;">
                                            <input type="range" id="batch-delay-slider-groups" min="5" max="50" value="30" step="1" oninput="updateBatchDelayValueGroups()" style="flex: 1; background: linear-gradient(to right, #10b981 0%, #10b981 56%, #e5e7eb 56%, #e5e7eb 100%);">
                                            <input type="number" id="batch-delay-groups" value="30" min="5" max="50" step="1" oninput="updateBatchDelayFromInputGroups()" style="width: 80px; padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em; text-align: center;">
                                            <span style="color: #666; font-weight: 500;">segundos</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Programe su campa√±a -->
                                <div style="margin-bottom: 20px;">
                                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px; cursor: pointer;">
                                        <input type="checkbox" id="enable-schedule-groups" onchange="toggleScheduleOptionsGroups()" style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981; flex-shrink: 0;">
                                        <span style="font-weight: 600; color: #333; font-size: 1.05em;">Programe su campa√±a</span>
                                    </label>
                                    
                                    <div id="schedule-options-groups" style="margin-top: 10px; display: none; padding: 15px; background: #f9fafb; border-radius: 8px;">
                                        <label style="display: block; color: #666; font-size: 0.9em; margin-bottom: 10px; font-weight: 500;">Fecha y hora de inicio</label>
                                        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                                            <input type="date" id="schedule-date-groups" style="flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em;">
                                            <input type="time" id="schedule-time-groups" style="flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em;">
                                        </div>
                                    </div>
                                    
                                    <!-- Botones de campa√±as -->
                                    <div style="margin-top: 15px; display: flex; flex-direction: column; gap: 10px;">
                                        <div style="position: relative;">
                                            <button onclick="toggleUpcomingCampaignsGroups()" id="upcoming-campaigns-groups-btn" style="width: 100%; padding: 12px 20px; background: white; border: 2px solid #10b981; color: #10b981; border-radius: 8px; font-weight: 600; font-size: 1em; cursor: pointer; display: flex; align-items: center; justify-content: space-between; transition: all 0.2s;" onmouseover="this.style.background='#f0fdf4'" onmouseout="this.style.background='white'">
                                                <span>Ver campa√±as programadas</span>
                                                <span style="font-size: 0.8em;">‚ñº</span>
                                            </button>
                                            
                                            <!-- Dropdown de campa√±as programadas -->
                                            <div id="upcoming-campaigns-groups-dropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); margin-top: 5px; z-index: 1000; max-height: 300px; overflow-y: auto;">
                                                <div style="padding: 20px; color: #9ca3af; text-align: center; font-size: 0.95em;">
                                                    No hay campa√±as programadas
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div style="position: relative;">
                                            <button onclick="togglePausedCampaignsGroups()" id="paused-campaigns-groups-btn" style="width: 100%; padding: 12px 20px; background: white; border: 2px solid #10b981; color: #10b981; border-radius: 8px; font-weight: 600; font-size: 1em; cursor: pointer; display: flex; align-items: center; justify-content: space-between; transition: all 0.2s;" onmouseover="this.style.background='#f0fdf4'" onmouseout="this.style.background='white'">
                                                <span>Reanudar campa√±as pausadas</span>
                                                <span style="font-size: 0.8em;">‚ñº</span>
                                            </button>
                                            
                                            <!-- Dropdown de campa√±as pausadas -->
                                            <div id="paused-campaigns-groups-dropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); margin-top: 5px; z-index: 1000; max-height: 300px; overflow-y: auto;">
                                                <div style="padding: 20px; color: #9ca3af; text-align: center; font-size: 0.95em;">
                                                    Sin campa√±as pausadas
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                    
                </div>

                <!-- Modal: Add Campaign Groups -->
                <div id="add-campaign-groups-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center;">
                    <div style="background: #d1e7dd; padding: 30px; border-radius: 15px; max-width: 600px; width: 90%; position: relative;">
                        <button onclick="closeAddCampaignGroupModal()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 2em; cursor: pointer; color: #333;">√ó</button>
                        
                        <h2 style="margin-bottom: 20px; color: #333;">Save Campaign Groups</h2>
                        
                        <div style="margin-bottom: 20px;">
                            <textarea id="campaign-groups-content" placeholder="Grupos seleccionados..." style="width: 100%; min-height: 200px; padding: 15px; border: 2px solid #b8dac6; border-radius: 8px; font-size: 1em; resize: vertical; font-family: inherit; background: white;"></textarea>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                            <label style="color: #333; font-weight: bold;">Nombre de la campa√±a</label>
                            <input type="text" id="campaign-groups-name" placeholder="Nombre de la campa√±a" style="flex: 1; padding: 12px; border: 2px solid #b8dac6; border-radius: 8px; font-size: 1em; background: white;">
                        </div>
                        
                        <button onclick="saveCampaignGroups()" style="background: #26a69a; color: white; border: none; padding: 15px 40px; border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer; width: 100%;">
                            Save Campaign Groups
                        </button>
                    </div>
                </div>
                </div>

                <!-- Secci√≥n para Contacts -->
                <div id="section-contacts" style="display: none;">
                    <!-- Layout de dos columnas -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        
                        <!-- COLUMNA IZQUIERDA -->
                        <div>
                            <div class="form-group">
                                <label style="font-weight: bold; font-size: 1.1em; margin-bottom: 10px; display: block;">Select contacts to message</label>
                                
                                <!-- Campo clickeable para desplegar contactos -->
                                <div style="position: relative;">
                                    <div onclick="toggleContactsDropdown()" id="contacts-selector-btn" style="width: 100%; padding: 15px; border: 2px solid #d1d5db; border-radius: 10px; background: white; cursor: pointer; min-height: 120px; position: relative; padding-bottom: 60px;">
                                        <span id="contacts-placeholder" style="color: #9ca3af; font-size: 1em;">Select contacts from the dropdown . . .</span>
                                        
                                        <!-- Contenedor de contactos seleccionados como tags -->
                                        <div id="contacts-selected-tags" style="display: none; flex-wrap: wrap; gap: 10px;">
                                            <!-- Los tags se agregar√°n aqu√≠ din√°micamente -->
                                        </div>
                                        
                                        <!-- Bot√≥n de basurero para eliminar todos -->
                                        <button id="clear-all-contacts-btn" onclick="clearAllContacts(event)" style="display: none; position: absolute; top: 15px; right: 15px; background: #f3f4f6; border: 2px solid #e5e7eb; border-radius: 6px; padding: 8px; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#fee2e2'; this.style.borderColor='#fca5a5'" onmouseout="this.style.background='#f3f4f6'; this.style.borderColor='#e5e7eb'">
                                            üóëÔ∏è
                                        </button>
                                        
                                        <!-- Botones en la parte inferior derecha -->
                                        <div style="position: absolute; bottom: 15px; right: 15px; display: flex; gap: 10px; align-items: center;">
                                            <!-- Bot√≥n Campaign Contacts -->
                                            <div style="position: relative;">
                                                <button onclick="toggleCampaignContactsMenu(event)" id="campaign-contacts-btn" style="padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; cursor: pointer; font-size: 0.9em; min-width: 180px; color: #666; display: flex; align-items: center; justify-content: space-between; gap: 8px;">
                                                    <span>Campaign Contacts</span>
                                                    <span style="font-size: 0.8em;">‚ñº</span>
                                                </button>
                                                
                                                <!-- Men√∫ desplegable de Campaign Contacts -->
                                                <div id="campaign-contacts-dropdown" style="display: none; position: absolute; bottom: 100%; right: 0; background: white; border: 2px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 250px; margin-bottom: 5px; z-index: 1000;">
                                                    <div style="padding: 15px; color: #9ca3af; text-align: center; border-bottom: 1px solid #e5e7eb; font-size: 1.1em;">
                                                        ¬°Nada que mostrar!
                                                    </div>
                                                    <div onclick="showAddCampaignContactModal()" style="padding: 12px 15px; cursor: pointer; display: flex; align-items: center; gap: 8px; color: #10b981; font-weight: bold; transition: background 0.2s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='white'">
                                                        üìã <span style="color: #10b981;">Add Template</span>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Bot√≥n de guardar (diskette) -->
                                            <button id="save-contacts-btn" onclick="showAddCampaignContactModal(event)" style="display: none; background: #10b981; border: none; border-radius: 6px; padding: 10px 12px; cursor: pointer; transition: all 0.2s; color: white; font-size: 1.2em;" onmouseover="this.style.background='#059669'" onmouseout="this.style.background='#10b981'" title="Guardar selecci√≥n">
                                                üíæ
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Dropdown de contactos -->
                                    <div id="contacts-dropdown-menu" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); margin-top: 5px; z-index: 1000; max-height: 400px; overflow: hidden;">
                                        <!-- Barra de b√∫squeda -->
                                        <div style="padding: 15px; border-bottom: 1px solid #e5e7eb; background: #f9fafb;">
                                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                                <input type="text" id="search-contacts" placeholder="üîç Buscar contacto por nombre" style="flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 0.95em;" oninput="filterContacts()" onclick="event.stopPropagation()">
                                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; white-space: nowrap; font-weight: 500;">
                                                    <input type="checkbox" id="select-all-contacts" onchange="toggleSelectAllContacts()" style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981;">
                                                    Select All
                                                </label>
                                            </div>
                                        </div>
                                        
                                        <!-- Lista de contactos -->
                                        <div id="contacts-list" style="max-height: 300px; overflow-y: auto; padding: 10px;">
                                            <p style="color: #666; text-align: center; padding: 20px;">Cargando contactos...</p>
                                        </div>
                                    </div>
                                </div>
                        </div>

                    <!-- √Årea de mensaje con opciones de formato -->
                    <div class="form-group" style="margin-top: 20px;">
                        <label>Introducir mensaje</label>
                        <div style="border: 2px solid #e5e7eb; border-radius: 8px; overflow: hidden;">
                            <!-- Barra de formato -->
                            <div style="background: #f9fafb; padding: 8px; border-bottom: 1px solid #e5e7eb; display: flex; gap: 10px; align-items: center;">
                                <button onclick="formatTextContacts('bold')" style="padding: 5px 10px; border: 1px solid #e5e7eb; background: white; border-radius: 4px; cursor: pointer; font-weight: bold;">*text*</button>
                                <button onclick="formatTextContacts('italic')" style="padding: 5px 10px; border: 1px solid #e5e7eb; background: white; border-radius: 4px; cursor: pointer; font-style: italic;">_text_</button>
                                <button onclick="formatTextContacts('strike')" style="padding: 5px 10px; border: 1px solid #e5e7eb; background: white; border-radius: 4px; cursor: pointer; text-decoration: line-through;">~text~</button>
                                <button onclick="formatTextContacts('code')" style="padding: 5px 10px; border: 1px solid #e5e7eb; background: white; border-radius: 4px; cursor: pointer; font-family: monospace;">`text`</button>
                                <span style="color: #999; margin-left: auto;">EMOJIS</span>
                            </div>
                            
                            <!-- √Årea de texto -->
                            <textarea id="message-contacts" placeholder="Escribe tu mensaje aqu√≠..." style="width: 100%; min-height: 150px; border: none; padding: 15px; font-size: 1em; resize: vertical; font-family: inherit;"></textarea>
                            
                            <!-- Barra inferior con clip y template -->
                            <div style="background: #f9fafb; padding: 10px; border-top: 1px solid #e5e7eb; display: flex; gap: 10px; align-items: center;">
                                <button onclick="attachFileContacts()" style="padding: 8px 15px; border: 1px solid #e5e7eb; background: white; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 5px;">
                                    üìé
                                </button>
                                
                                <div style="position: relative;">
                                    <button onclick="toggleTemplateMenuContacts()" id="template-contacts-btn" style="padding: 8px 15px; border: 1px solid #e5e7eb; background: white; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 5px;">
                                        Template ‚ñº
                                    </button>
                                    
                                    <!-- Men√∫ desplegable de templates -->
                                    <div id="template-contacts-dropdown" style="display: none; position: absolute; bottom: 100%; left: 0; background: white; border: 2px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 200px; margin-bottom: 5px; z-index: 1000;">
                                        <div style="padding: 10px; color: #666; text-align: center; border-bottom: 1px solid #e5e7eb;">
                                            ¬°Nada que mostrar!
                                        </div>
                                        <div onclick="showAddTemplateModalContacts()" style="padding: 12px; cursor: pointer; display: flex; align-items: center; gap: 8px; color: #10b981; font-weight: bold; transition: background 0.2s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='white'">
                                            üìã Add Template
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bot√≥n Enviar Mensajes -->
                    <button class="btn-primary" onclick="sendCampaignContacts()" style="width: 100%; margin-top: 20px;">
                        üì§ Enviar Mensajes
                    </button>
                    
                    <div class="campaign-controls" id="campaign-controls-contacts" style="display: none; margin-top: 10px;">
                        <button class="btn-primary btn-pause" onclick="pauseCampaignContacts()" style="width: 100%; margin-bottom: 10px;">‚è∏Ô∏è Pausar</button>
                        <button class="btn-primary btn-stop" onclick="stopCampaignContacts()" style="width: 100%;">üõë Detener</button>
                    </div>
                    
                    <div id="status-message-contacts" class="status-message"></div>
                    </div>
                    
                    <!-- COLUMNA DERECHA - Opciones Avanzadas -->
                    <div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 15px;">
                                <span style="font-size: 1.2em;">‚öôÔ∏è</span>
                                <span style="font-weight: bold; font-size: 1.1em;">Opciones Avanzadas</span>
                            </label>
                            
                            <div style="border: 2px solid #e5e7eb; border-radius: 10px; padding: 20px; background: white;">
                                
                                <!-- Agregar intervalos de tiempo -->
                                <div style="margin-bottom: 20px;">
                                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 15px; cursor: pointer;">
                                        <input type="checkbox" id="enable-delays-contacts" onchange="toggleDelayOptionsContacts()" style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981; flex-shrink: 0;">
                                        <span style="font-weight: 600; color: #333; font-size: 1.05em;">Agregar un intervalo de tiempo entre mensajes</span>
                                    </label>
                                    
                                    <div id="delay-options-contacts" style="margin-top: 15px; display: none; padding: 15px; background: #f9fafb; border-radius: 8px;">
                                        <!-- Opci√≥n con Slider -->
                                        <div style="margin-bottom: 20px;">
                                            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer;">
                                                <input type="radio" name="delay-mode-contacts" value="slider" checked onchange="toggleDelayModeContacts()" style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981;">
                                                <span style="font-weight: 500; color: #333;">Fijo</span>
                                            </label>
                                            
                                            <div id="slider-option-contacts" style="display: flex; align-items: center; gap: 15px; padding-left: 28px; padding-top: 10px; padding-bottom: 10px;">
                                                <input type="range" id="delay-slider-contacts" min="1" max="60" value="3" step="1" oninput="updateSliderValueContacts()" style="flex: 1; background: linear-gradient(to right, #10b981 0%, #10b981 5%, #e5e7eb 5%, #e5e7eb 100%);">
                                                <input type="number" id="delay-slider-value-contacts" value="3" min="1" max="60" step="1" oninput="updateSliderFromInputContacts()" style="width: 80px; padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em; text-align: center;">
                                                <span style="color: #666; font-weight: 500;">sec</span>
                                            </div>
                                        </div>
                                        
                                        <!-- Opci√≥n Aleatorio -->
                                        <div style="margin-bottom: 20px;">
                                            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; cursor: pointer;">
                                                <input type="radio" name="delay-mode-contacts" value="random" onchange="toggleDelayModeContacts()" style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981;">
                                                <span style="font-weight: 500; color: #333;">Aleatorio</span>
                                            </label>
                                        </div>
                                        
                                        <!-- Opci√≥n Personalizado aleatorio (Recomendado) -->
                                        <div>
                                            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer;">
                                                <input type="radio" name="delay-mode-contacts" value="custom" onchange="toggleDelayModeContacts()" style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981;">
                                                <span style="font-weight: 500; color: #333;">Personalizado aleatorio <span style="color: #ef4444; font-weight: 600;">(Recomendado)</span></span>
                                                <span style="margin-left: auto; color: #9ca3af; cursor: help;" title="Esta opci√≥n var√≠a el tiempo entre mensajes de forma aleatoria para parecer m√°s natural">‚ùì</span>
                                            </label>
                                            
                                            <div id="custom-option-contacts" style="display: none; padding-left: 28px;">
                                                <div style="display: flex; gap: 10px; align-items: center;">
                                                    <span style="color: #666; font-weight: 500;">De:</span>
                                                    <input type="number" id="delay-min-contacts" value="5" min="1" max="60" step="1" style="flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em;">
                                                    <span style="color: #666; font-weight: 500;">A:</span>
                                                    <input type="number" id="delay-max-contacts" value="15" min="1" max="60" step="1" style="flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em;">
                                                    <span style="color: #666; font-weight: 500;">segundos</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Agregar lotes -->
                                <div style="margin-bottom: 20px;">
                                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px; cursor: pointer;">
                                        <input type="checkbox" id="enable-batches-contacts" onchange="toggleBatchOptionsContacts()" style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981; flex-shrink: 0;">
                                        <span style="font-weight: 600; color: #333; font-size: 1.05em;">Agregar lotes <span style="color: #10b981;">(Recomendado)</span></span>
                                    </label>
                                    
                                    <div id="batch-options-contacts" style="margin-top: 10px; display: none; padding: 15px; background: #f9fafb; border-radius: 8px;">
                                        <label style="display: block; color: #666; font-size: 0.9em; margin-bottom: 10px; font-weight: 500;">Enviar en lotes de</label>
                                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                                            <input type="range" id="batch-size-slider-contacts" min="10" max="50" value="50" step="1" oninput="updateBatchSizeValueContacts()" style="flex: 1; background: linear-gradient(to right, #10b981 0%, #10b981 100%, #e5e7eb 100%, #e5e7eb 100%);">
                                            <input type="number" id="batch-size-contacts" value="50" min="10" max="50" step="1" oninput="updateBatchSizeFromInputContacts()" style="width: 80px; padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em; text-align: center;">
                                            <span style="color: #666; font-weight: 500;">mensajes</span>
                                        </div>
                                        
                                        <label style="display: block; color: #666; font-size: 0.9em; margin-bottom: 10px; font-weight: 500;">Agregue un intervalo de tiempo en lotes en blanco y negro de</label>
                                        <div style="display: flex; align-items: center; gap: 15px;">
                                            <input type="range" id="batch-delay-slider-contacts" min="5" max="50" value="30" step="1" oninput="updateBatchDelayValueContacts()" style="flex: 1; background: linear-gradient(to right, #10b981 0%, #10b981 56%, #e5e7eb 56%, #e5e7eb 100%);">
                                            <input type="number" id="batch-delay-contacts" value="30" min="5" max="50" step="1" oninput="updateBatchDelayFromInputContacts()" style="width: 80px; padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em; text-align: center;">
                                            <span style="color: #666; font-weight: 500;">segundos</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Programe su campa√±a -->
                                <div style="margin-bottom: 20px;">
                                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px; cursor: pointer;">
                                        <input type="checkbox" id="enable-schedule-contacts" onchange="toggleScheduleOptionsContacts()" style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981; flex-shrink: 0;">
                                        <span style="font-weight: 600; color: #333; font-size: 1.05em;">Programe su campa√±a</span>
                                    </label>
                                    
                                    <div id="schedule-options-contacts" style="margin-top: 10px; display: none; padding: 15px; background: #f9fafb; border-radius: 8px;">
                                        <label style="display: block; color: #666; font-size: 0.9em; margin-bottom: 10px; font-weight: 500;">Fecha y hora de inicio</label>
                                        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                                            <input type="date" id="schedule-date-contacts" style="flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em;">
                                            <input type="time" id="schedule-time-contacts" style="flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em;">
                                        </div>
                                    </div>
                                    
                                    <!-- Botones de campa√±as -->
                                    <div style="margin-top: 15px; display: flex; flex-direction: column; gap: 10px;">
                                        <div style="position: relative;">
                                            <button onclick="toggleUpcomingCampaignsContacts()" id="upcoming-campaigns-contacts-btn" style="width: 100%; padding: 12px 20px; background: white; border: 2px solid #10b981; color: #10b981; border-radius: 8px; font-weight: 600; font-size: 1em; cursor: pointer; display: flex; align-items: center; justify-content: space-between; transition: all 0.2s;" onmouseover="this.style.background='#f0fdf4'" onmouseout="this.style.background='white'">
                                                <span>Ver campa√±as programadas</span>
                                                <span style="font-size: 0.8em;">‚ñº</span>
                                            </button>
                                            
                                            <!-- Dropdown de campa√±as programadas -->
                                            <div id="upcoming-campaigns-contacts-dropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); margin-top: 5px; z-index: 1000; max-height: 300px; overflow-y: auto;">
                                                <div style="padding: 20px; color: #9ca3af; text-align: center; font-size: 0.95em;">
                                                    No hay campa√±as programadas
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div style="position: relative;">
                                            <button onclick="togglePausedCampaignsContacts()" id="paused-campaigns-contacts-btn" style="width: 100%; padding: 12px 20px; background: white; border: 2px solid #10b981; color: #10b981; border-radius: 8px; font-weight: 600; font-size: 1em; cursor: pointer; display: flex; align-items: center; justify-content: space-between; transition: all 0.2s;" onmouseover="this.style.background='#f0fdf4'" onmouseout="this.style.background='white'">
                                                <span>Reanudar campa√±as pausadas</span>
                                                <span style="font-size: 0.8em;">‚ñº</span>
                                            </button>
                                            
                                            <!-- Dropdown de campa√±as pausadas -->
                                            <div id="paused-campaigns-contacts-dropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); margin-top: 5px; z-index: 1000; max-height: 300px; overflow-y: auto;">
                                                <div style="padding: 20px; color: #9ca3af; text-align: center; font-size: 0.95em;">
                                                    Sin campa√±as pausadas
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                    
                </div>
                </div>


            </div>

            <!-- Tab Content: Estad√≠sticas -->
            <div id="tab-stats" class="tab-content">
                <h2>üìä Estad√≠sticas de Env√≠os</h2>
                <p style="color: #666; margin-bottom: 20px;">Monitorea el rendimiento de tus campa√±as</p>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold;" id="stat-total">0</div>
                        <div style="font-size: 1.1em;">Total Grupos</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold;" id="stat-sent">0</div>
                        <div style="font-size: 1.1em;">Enviados</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold;" id="stat-failed">0</div>
                        <div style="font-size: 1.1em;">Fallidos</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold;" id="stat-progress">0%</div>
                        <div style="font-size: 1.1em;">Progreso</div>
                    </div>
                </div>

                <h3 style="margin-bottom: 15px;">Historial de Campa√±as</h3>
                <div id="campaigns-history" style="border: 2px solid #e5e7eb; border-radius: 8px; padding: 15px; min-height: 300px;">
                    <p style="color: #666;">No hay historial de campa√±as</p>
                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let selectedGroups = [];
        let allGroups = [];
        let selectedNumbers = [];
        let phone = '';
        let campaignRunning = false;

        window.onload = () => {
            const urlParams = new URLSearchParams(window.location.search);
            phone = urlParams.get('phone');
            const mode = urlParams.get('mode');
            
            // Detectar si est√° en un iframe y ocultar el header
            if (window.self !== window.top) {
                const header = document.getElementById('page-header');
                if (header) {
                    header.style.display = 'none';
                }
            }
            
            if (!phone) {
                alert('N√∫mero de tel√©fono no especificado');
                window.location.href = '/';
                return;
            }

            // Si viene el par√°metro mode=groups, seleccionar autom√°ticamente Groups
            if (mode === 'groups') {
                const groupsRadio = document.querySelector('input[name="send-mode"][value="groups"]');
                if (groupsRadio) {
                    groupsRadio.checked = true;
                    changeSendMode('groups');
                }
            }

            loadGroups();
            loadTemplates();
            loadScheduledCampaigns();
            setupSocketListeners();
            initCountriesList();
        };

        function switchTab(tabName) {
            // Ocultar todos los tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Mostrar el tab seleccionado
            document.getElementById('tab-' + tabName).classList.add('active');
            event.target.classList.add('active');

            // Cargar datos seg√∫n el tab
            if (tabName === 'stats') {
                loadStatistics();
            }
        }

        function changeSendMode(mode) {
            // Ocultar todas las secciones
            document.getElementById('section-numbers').style.display = 'none';
            document.getElementById('section-groups').style.display = 'none';
            document.getElementById('section-contacts').style.display = 'none';

            // Mostrar la secci√≥n seleccionada
            document.getElementById('section-' + mode).style.display = 'block';

            // Cargar datos seg√∫n el modo
            if (mode === 'groups') {
                loadGroups();
            } else if (mode === 'contacts') {
                loadContacts();
            }
        }

        function filterGroups() {
            const searchTerm = document.getElementById('search-groups').value.toLowerCase();
            const labels = document.querySelectorAll('#groups-list label');
            
            labels.forEach(label => {
                const text = label.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    label.style.display = 'flex';
                } else {
                    label.style.display = 'none';
                }
            });
        }

        function handleNumberInput(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                
                const textarea = event.target;
                const lines = textarea.value.split('\n');
                
                // Obtener el c√≥digo de pa√≠s seleccionado
                const countryCodeElement = document.getElementById('selected-code');
                const countryCode = countryCodeElement ? countryCodeElement.textContent.replace('+', '') : '1';
                
                console.log('C√≥digo de pa√≠s seleccionado:', countryCode);
                
                // Procesar cada l√≠nea
                lines.forEach(line => {
                    const cleanNum = line.trim().replace(/\D/g, ''); // Solo d√≠gitos
                    if (cleanNum) {
                        console.log('N√∫mero ingresado (limpio):', cleanNum);
                        
                        // SIEMPRE agregar el c√≥digo de pa√≠s al inicio
                        // El usuario debe escribir solo el n√∫mero LOCAL (sin c√≥digo de pa√≠s)
                        const fullNumber = countryCode + cleanNum;
                        
                        console.log('N√∫mero completo con c√≥digo de pa√≠s:', fullNumber);
                        
                        // Agregar solo si no existe ya
                        if (!selectedNumbers.includes(fullNumber)) {
                            selectedNumbers.push(fullNumber);
                        }
                    }
                });
                
                // Limpiar el textarea
                textarea.value = '';
                
                // Actualizar el display
                updateNumbersDisplay();
            }
        }

        function updateNumbersDisplay() {
            const tagsContainer = document.getElementById('numbers-selected-tags');
            
            // Crear los tags para cada n√∫mero
            tagsContainer.innerHTML = selectedNumbers.map(num => {
                // Formatear el n√∫mero para mostrar: +XX XXXXXXXXX
                const formattedNum = '+' + num;
                
                return `
                    <div style="display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px; background: #d1fae5; border: 2px solid #10b981; border-radius: 8px; font-size: 0.95em; color: #065f46; font-family: monospace;">
                        <span>${formattedNum}</span>
                        <button onclick="removeNumber(event, '${num}')" style="background: none; border: none; cursor: pointer; font-size: 1.1em; color: #065f46; padding: 0; display: flex; align-items: center; font-weight: bold;" onmouseover="this.style.color='#dc2626'" onmouseout="this.style.color='#065f46'">
                            √ó
                        </button>
                    </div>
                `;
            }).join('');
        }

        function removeNumber(event, number) {
            event.preventDefault();
            event.stopPropagation();
            
            // Remover el n√∫mero de la lista
            selectedNumbers = selectedNumbers.filter(n => n !== number);
            
            // Actualizar el display
            updateNumbersDisplay();
        }

        function showExampleNumbers() {
            // Agregar n√∫meros de ejemplo
            const exampleNumbers = ['5062345678', '5062876543', '5063456789'];
            exampleNumbers.forEach(num => {
                if (!selectedNumbers.includes(num)) {
                    selectedNumbers.push(num);
                }
            });
            updateNumbersDisplay();
        }

        function downloadExcelTemplate() {
            // Crear datos de ejemplo para el template
            const data = [
                ['Phone Number'],
                ['5062345678'],
                ['5062876543'],
                ['5063456789'],
                ['5064567890']
            ];
            
            // Convertir a CSV (compatible con Excel)
            const csvContent = data.map(row => row.join(',')).join('\n');
            
            // Crear blob y descargar
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', 'template_numbers.csv');
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showStatus('success', '‚úÖ Template descargado exitosamente');
        }

        function uploadNumbersFile() {
            alert('Funcionalidad de subir Excel en desarrollo');
        }

        function formatText(type) {
            const textarea = document.getElementById('message-numbers');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            if (!selectedText) {
                alert('Por favor selecciona el texto que deseas formatear');
                return;
            }
            
            let formattedText = '';
            switch(type) {
                case 'bold':
                    formattedText = `*${selectedText}*`;
                    break;
                case 'italic':
                    formattedText = `_${selectedText}_`;
                    break;
                case 'strike':
                    formattedText = `~${selectedText}~`;
                    break;
                case 'code':
                    formattedText = `\`${selectedText}\``;
                    break;
            }
            
            textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
            textarea.focus();
            textarea.setSelectionRange(start, start + formattedText.length);
        }

        function attachFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*,video/*,application/pdf,.doc,.docx';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    alert(`Archivo seleccionado: ${file.name}\n(Funcionalidad de env√≠o en desarrollo)`);
                }
            };
            input.click();
        }

        function toggleTemplateMenu() {
            const dropdown = document.getElementById('template-dropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        // Cerrar el men√∫ si se hace clic fuera de √©l
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('template-dropdown');
            const btn = document.getElementById('template-btn');
            
            if (dropdown && btn && !dropdown.contains(event.target) && !btn.contains(event.target)) {
                dropdown.style.display = 'none';
            }
        });

        function showAddTemplateModal() {
            document.getElementById('add-template-modal').style.display = 'flex';
            document.getElementById('template-dropdown').style.display = 'none';
        }

        function closeAddTemplateModal() {
            document.getElementById('add-template-modal').style.display = 'none';
            document.getElementById('template-content').value = '';
            document.getElementById('template-name').value = '';
        }

        function saveTemplate() {
            const content = document.getElementById('template-content').value.trim();
            const name = document.getElementById('template-name').value.trim();
            
            if (!content) {
                alert('Por favor escribe el contenido de la plantilla');
                return;
            }
            
            if (!name) {
                alert('Por favor escribe un nombre para la plantilla');
                return;
            }
            
            fetch('/api/templates', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    name: name, 
                    message: content, 
                    category: 'general' 
                })
            })
            .then(res => res.json())
            .then(result => {
                if (result.success) {
                    alert('‚úÖ Template guardado exitosamente');
                    closeAddTemplateModal();
                    loadTemplates();
                } else {
                    alert('‚ùå Error: ' + result.error);
                }
            })
            .catch(error => {
                alert('‚ùå Error al guardar template: ' + error.message);
            });
        }

        // Lista completa de pa√≠ses con c√≥digos ISO
        const countries = [
            { name: 'Canada', code: '+1', iso: 'CA', native: 'Canada' },
            { name: 'United States', code: '+1', iso: 'US', native: 'United States' },
            { name: 'Afghanistan', code: '+93', iso: 'AF', native: 'ÿßŸÅÿ∫ÿßŸÜÿ≥ÿ™ÿßŸÜ' },
            { name: 'Albania', code: '+355', iso: 'AL', native: 'Shqip√´ri' },
            { name: 'Algeria', code: '+213', iso: 'DZ', native: 'ÿßŸÑÿ¨ÿ≤ÿßÿ¶ÿ±' },
            { name: 'American Samoa', code: '+1', iso: 'AS', native: 'American Samoa' },
            { name: 'Andorra', code: '+376', iso: 'AD', native: 'Andorra' },
            { name: 'Angola', code: '+244', iso: 'AO', native: 'Angola' },
            { name: 'Argentina', code: '+54', iso: 'AR', native: 'Argentina' },
            { name: 'Armenia', code: '+374', iso: 'AM', native: '’Ä’°’µ’°’Ω’ø’°’∂' },
            { name: 'Australia', code: '+61', iso: 'AU', native: 'Australia' },
            { name: 'Austria', code: '+43', iso: 'AT', native: '√ñsterreich' },
            { name: 'Azerbaijan', code: '+994', iso: 'AZ', native: 'Az…ôrbaycan' },
            { name: 'Bahamas', code: '+1242', iso: 'BS', native: 'Bahamas' },
            { name: 'Bahrain', code: '+973', iso: 'BH', native: 'ÿßŸÑÿ®ÿ≠ÿ±ŸäŸÜ' },
            { name: 'Bangladesh', code: '+880', iso: 'BD', native: '‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂' },
            { name: 'Barbados', code: '+1246', iso: 'BB', native: 'Barbados' },
            { name: 'Belarus', code: '+375', iso: 'BY', native: '–ë–µ–ª–∞—Ä—É—Å—å' },
            { name: 'Belgium', code: '+32', iso: 'BE', native: 'Belgi√´' },
            { name: 'Belize', code: '+501', iso: 'BZ', native: 'Belize' },
            { name: 'Benin', code: '+229', iso: 'BJ', native: 'B√©nin' },
            { name: 'Bolivia', code: '+591', iso: 'BO', native: 'Bolivia' },
            { name: 'Bosnia', code: '+387', iso: 'BA', native: 'Bosna i Hercegovina' },
            { name: 'Botswana', code: '+267', iso: 'BW', native: 'Botswana' },
            { name: 'Brazil', code: '+55', iso: 'BR', native: 'Brasil' },
            { name: 'Bulgaria', code: '+359', iso: 'BG', native: '–ë—ä–ª–≥–∞—Ä–∏—è' },
            { name: 'Cambodia', code: '+855', iso: 'KH', native: '·ûÄ·ûò·üí·ûñ·ûª·ûá·û∂' },
            { name: 'Cameroon', code: '+237', iso: 'CM', native: 'Cameroun' },
            { name: 'Chile', code: '+56', iso: 'CL', native: 'Chile' },
            { name: 'China', code: '+86', iso: 'CN', native: '‰∏≠ÂõΩ' },
            { name: 'Colombia', code: '+57', iso: 'CO', native: 'Colombia' },
            { name: 'Costa Rica', code: '+506', iso: 'CR', native: 'Costa Rica' },
            { name: 'Croatia', code: '+385', iso: 'HR', native: 'Hrvatska' },
            { name: 'Cuba', code: '+53', iso: 'CU', native: 'Cuba' },
            { name: 'Cyprus', code: '+357', iso: 'CY', native: 'ŒöœçœÄœÅŒøœÇ' },
            { name: 'Czech Republic', code: '+420', iso: 'CZ', native: 'ƒåesk√° republika' },
            { name: 'Denmark', code: '+45', iso: 'DK', native: 'Danmark' },
            { name: 'Dominican Republic', code: '+1809', iso: 'DO', native: 'Rep√∫blica Dominicana' },
            { name: 'Ecuador', code: '+593', iso: 'EC', native: 'Ecuador' },
            { name: 'Egypt', code: '+20', iso: 'EG', native: 'ŸÖÿµÿ±' },
            { name: 'El Salvador', code: '+503', iso: 'SV', native: 'El Salvador' },
            { name: 'Estonia', code: '+372', iso: 'EE', native: 'Eesti' },
            { name: 'Ethiopia', code: '+251', iso: 'ET', native: '·ä¢·âµ·ãÆ·åµ·ã´' },
            { name: 'Finland', code: '+358', iso: 'FI', native: 'Suomi' },
            { name: 'France', code: '+33', iso: 'FR', native: 'France' },
            { name: 'Germany', code: '+49', iso: 'DE', native: 'Deutschland' },
            { name: 'Ghana', code: '+233', iso: 'GH', native: 'Ghana' },
            { name: 'Greece', code: '+30', iso: 'GR', native: 'ŒïŒªŒªŒ¨Œ¥Œ±' },
            { name: 'Guatemala', code: '+502', iso: 'GT', native: 'Guatemala' },
            { name: 'Haiti', code: '+509', iso: 'HT', native: 'Ha√Øti' },
            { name: 'Honduras', code: '+504', iso: 'HN', native: 'Honduras' },
            { name: 'Hong Kong', code: '+852', iso: 'HK', native: 'È¶ôÊ∏Ø' },
            { name: 'Hungary', code: '+36', iso: 'HU', native: 'Magyarorsz√°g' },
            { name: 'Iceland', code: '+354', iso: 'IS', native: '√çsland' },
            { name: 'India', code: '+91', iso: 'IN', native: '‡§≠‡§æ‡§∞‡§§' },
            { name: 'Indonesia', code: '+62', iso: 'ID', native: 'Indonesia' },
            { name: 'Iran', code: '+98', iso: 'IR', native: 'ÿß€åÿ±ÿßŸÜ' },
            { name: 'Iraq', code: '+964', iso: 'IQ', native: 'ÿßŸÑÿπÿ±ÿßŸÇ' },
            { name: 'Ireland', code: '+353', iso: 'IE', native: '√âire' },
            { name: 'Israel', code: '+972', iso: 'IL', native: '◊ô◊©◊®◊ê◊ú' },
            { name: 'Italy', code: '+39', iso: 'IT', native: 'Italia' },
            { name: 'Jamaica', code: '+1876', iso: 'JM', native: 'Jamaica' },
            { name: 'Japan', code: '+81', iso: 'JP', native: 'Êó•Êú¨' },
            { name: 'Jordan', code: '+962', iso: 'JO', native: 'ÿßŸÑÿ£ÿ±ÿØŸÜ' },
            { name: 'Kazakhstan', code: '+7', iso: 'KZ', native: '“ö–∞–∑–∞“õ—Å—Ç–∞–Ω' },
            { name: 'Kenya', code: '+254', iso: 'KE', native: 'Kenya' },
            { name: 'Kuwait', code: '+965', iso: 'KW', native: 'ÿßŸÑŸÉŸàŸäÿ™' },
            { name: 'Latvia', code: '+371', iso: 'LV', native: 'Latvija' },
            { name: 'Lebanon', code: '+961', iso: 'LB', native: 'ŸÑÿ®ŸÜÿßŸÜ' },
            { name: 'Libya', code: '+218', iso: 'LY', native: 'ŸÑŸäÿ®Ÿäÿß' },
            { name: 'Lithuania', code: '+370', iso: 'LT', native: 'Lietuva' },
            { name: 'Luxembourg', code: '+352', iso: 'LU', native: 'Luxembourg' },
            { name: 'Malaysia', code: '+60', iso: 'MY', native: 'Malaysia' },
            { name: 'Mexico', code: '+52', iso: 'MX', native: 'M√©xico' },
            { name: 'Morocco', code: '+212', iso: 'MA', native: 'ÿßŸÑŸÖÿ∫ÿ±ÿ®' },
            { name: 'Netherlands', code: '+31', iso: 'NL', native: 'Nederland' },
            { name: 'New Zealand', code: '+64', iso: 'NZ', native: 'New Zealand' },
            { name: 'Nicaragua', code: '+505', iso: 'NI', native: 'Nicaragua' },
            { name: 'Nigeria', code: '+234', iso: 'NG', native: 'Nigeria' },
            { name: 'Norway', code: '+47', iso: 'NO', native: 'Norge' },
            { name: 'Pakistan', code: '+92', iso: 'PK', native: 'Ÿæÿß⁄©ÿ≥ÿ™ÿßŸÜ' },
            { name: 'Panama', code: '+507', iso: 'PA', native: 'Panam√°' },
            { name: 'Paraguay', code: '+595', iso: 'PY', native: 'Paraguay' },
            { name: 'Peru', code: '+51', iso: 'PE', native: 'Per√∫' },
            { name: 'Philippines', code: '+63', iso: 'PH', native: 'Philippines' },
            { name: 'Poland', code: '+48', iso: 'PL', native: 'Polska' },
            { name: 'Portugal', code: '+351', iso: 'PT', native: 'Portugal' },
            { name: 'Puerto Rico', code: '+1787', iso: 'PR', native: 'Puerto Rico' },
            { name: 'Qatar', code: '+974', iso: 'QA', native: 'ŸÇÿ∑ÿ±' },
            { name: 'Romania', code: '+40', iso: 'RO', native: 'Rom√¢nia' },
            { name: 'Russia', code: '+7', iso: 'RU', native: '–†–æ—Å—Å–∏—è' },
            { name: 'Saudi Arabia', code: '+966', iso: 'SA', native: 'ÿßŸÑÿ≥ÿπŸàÿØŸäÿ©' },
            { name: 'Serbia', code: '+381', iso: 'RS', native: '–°—Ä–±–∏—ò–∞' },
            { name: 'Singapore', code: '+65', iso: 'SG', native: 'Singapore' },
            { name: 'Slovakia', code: '+421', iso: 'SK', native: 'Slovensko' },
            { name: 'Slovenia', code: '+386', iso: 'SI', native: 'Slovenija' },
            { name: 'South Africa', code: '+27', iso: 'ZA', native: 'South Africa' },
            { name: 'South Korea', code: '+82', iso: 'KR', native: 'ÎåÄÌïúÎØºÍµ≠' },
            { name: 'Spain', code: '+34', iso: 'ES', native: 'Espa√±a' },
            { name: 'Sri Lanka', code: '+94', iso: 'LK', native: '‡∑Å‡∑ä‚Äç‡∂ª‡∑ì ‡∂Ω‡∂Ç‡∂ö‡∑è' },
            { name: 'Sweden', code: '+46', iso: 'SE', native: 'Sverige' },
            { name: 'Switzerland', code: '+41', iso: 'CH', native: 'Schweiz' },
            { name: 'Syria', code: '+963', iso: 'SY', native: 'ÿ≥Ÿàÿ±Ÿäÿß' },
            { name: 'Taiwan', code: '+886', iso: 'TW', native: 'Âè∞ÁÅ£' },
            { name: 'Thailand', code: '+66', iso: 'TH', native: '‡πÑ‡∏ó‡∏¢' },
            { name: 'Tunisia', code: '+216', iso: 'TN', native: 'ÿ™ŸàŸÜÿ≥' },
            { name: 'Turkey', code: '+90', iso: 'TR', native: 'T√ºrkiye' },
            { name: 'Ukraine', code: '+380', iso: 'UA', native: '–£–∫—Ä–∞—ó–Ω–∞' },
            { name: 'United Arab Emirates', code: '+971', iso: 'AE', native: 'ÿßŸÑÿ•ŸÖÿßÿ±ÿßÿ™' },
            { name: 'United Kingdom', code: '+44', iso: 'GB', native: 'United Kingdom' },
            { name: 'Uruguay', code: '+598', iso: 'UY', native: 'Uruguay' },
            { name: 'Venezuela', code: '+58', iso: 'VE', native: 'Venezuela' },
            { name: 'Vietnam', code: '+84', iso: 'VN', native: 'Vi·ªát Nam' },
            { name: 'Yemen', code: '+967', iso: 'YE', native: 'ÿßŸÑŸäŸÖŸÜ' }
        ];

        let allCountries = countries;
        let selectedCountryCode = '+1';
        let selectedCountry = { code: '+1', iso: 'CA', name: 'Canada' };

        // Inicializar lista de pa√≠ses
        function initCountriesList() {
            displayCountries(allCountries);
        }

        function displayCountries(countriesToShow) {
            const container = document.getElementById('countries-list');
            
            container.innerHTML = countriesToShow.map(country => {
                const safeName = country.name.replace(/'/g, "\\'");
                const flagUrl = `https://flagcdn.com/w40/${country.iso.toLowerCase()}.png`;
                
                return `
                <div onclick="selectCountry('${country.code}', '${country.iso}', '${safeName}')" style="padding: 12px; cursor: pointer; display: flex; align-items: center; gap: 12px; border-bottom: 1px solid #f3f4f6; transition: background 0.2s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='white'">
                    <img src="${flagUrl}" alt="${country.iso}" style="width: 32px; height: 24px; border-radius: 3px; object-fit: cover; box-shadow: 0 1px 3px rgba(0,0,0,0.1);" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div style="display: none; width: 32px; height: 24px; background: #f3f4f6; border-radius: 3px; align-items: center; justify-content: center; font-weight: bold; font-size: 0.7em; color: #666;">
                        ${country.iso}
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 500; color: #333;">${country.name}</div>
                        <div style="font-size: 0.85em; color: #999;">${country.native}</div>
                    </div>
                    <span style="color: #10b981; font-weight: bold;">${country.code}</span>
                </div>
                `;
            }).join('');
        }

        function toggleCountryDropdown() {
            const dropdown = document.getElementById('country-dropdown');
            const isVisible = dropdown.style.display === 'block';
            dropdown.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                document.getElementById('country-search').value = '';
                displayCountries(allCountries);
            }
        }

        function selectCountry(code, iso, name) {
            selectedCountryCode = code;
            selectedCountry = { code: code, iso: iso, name: name };
            const flagImg = document.getElementById('selected-flag-img');
            flagImg.src = `https://flagcdn.com/w40/${iso.toLowerCase()}.png`;
            flagImg.alt = iso;
            document.getElementById('selected-code').textContent = code;
            document.getElementById('country-dropdown').style.display = 'none';
            console.log('Pa√≠s seleccionado:', selectedCountry);
        }

        function filterCountries() {
            const searchTerm = document.getElementById('country-search').value.toLowerCase();
            const filtered = allCountries.filter(country => 
                country.name.toLowerCase().includes(searchTerm) ||
                country.native.toLowerCase().includes(searchTerm) ||
                country.code.includes(searchTerm)
            );
            displayCountries(filtered);
        }

        // Cerrar dropdown al hacer clic fuera
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('country-dropdown');
            const btn = document.getElementById('country-selector-btn');
            
            if (dropdown && btn && !dropdown.contains(event.target) && !btn.contains(event.target)) {
                dropdown.style.display = 'none';
            }
        });

        // Inicializar cuando cargue la p√°gina
        window.addEventListener('load', function() {
            initCountriesList();
            
            // Prevenir que el scroll del mouse cambie los valores de inputs num√©ricos
            document.querySelectorAll('input[type="number"]').forEach(input => {
                input.addEventListener('wheel', function(e) {
                    e.preventDefault();
                }, { passive: false });
            });
        });

        async function loadContacts() {
            // Simular carga de contactos
            const contactsSelect = document.getElementById('contacts-select');
            contactsSelect.innerHTML = `
                <option value="contact1">Juan P√©rez - +1234567890</option>
                <option value="contact2">Mar√≠a Garc√≠a - +0987654321</option>
                <option value="contact3">Carlos L√≥pez - +1122334455</option>
            `;
        }

        function filterContacts() {
            const searchTerm = document.getElementById('search-contacts').value.toLowerCase();
            const options = document.querySelectorAll('#contacts-select option');
            
            options.forEach(option => {
                const text = option.textContent.toLowerCase();
                option.style.display = text.includes(searchTerm) ? 'block' : 'none';
            });
        }

        function toggleSelectAllContacts() {
            const selectAll = document.getElementById('select-all-contacts').checked;
            const options = document.querySelectorAll('#contacts-select option');
            
            options.forEach(option => {
                option.selected = selectAll;
            });
        }

        function setupSocketListeners() {
            socket.on('campaign-completed', (data) => {
                if (data.phone === phone) {
                    showStatus('success', `‚úÖ Campa√±a completada! Enviados: ${data.results.sent}, Fallidos: ${data.results.failed}`);
                    campaignRunning = false;
                    document.getElementById('campaign-controls').style.display = 'none';
                }
            });

            socket.on('campaign-error', (data) => {
                if (data.phone === phone) {
                    showStatus('error', `‚ùå Error en campa√±a: ${data.error}`);
                    campaignRunning = false;
                    document.getElementById('campaign-controls').style.display = 'none';
                }
            });
        }

        async function loadGroups() {
            try {
                const response = await fetch(`/api/groups/successful`);
                const groups = await response.json();
                
                allGroups = groups;
                displayGroups(groups);
            } catch (error) {
                console.error('Error cargando grupos:', error);
                const container = document.getElementById('groups-list');
                container.innerHTML = '<p style="color: #ef4444; text-align: center; padding: 20px;">Error al cargar grupos</p>';
            }
        }

        function displayGroups(groups) {
            const container = document.getElementById('groups-list');
            
            if (groups.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">No hay grupos disponibles</p>';
                return;
            }

            container.innerHTML = groups.map(group => {
                const isChecked = selectedGroups.includes(group.group_id) ? 'checked' : '';
                return `
                <label style="display: flex; align-items: center; gap: 10px; padding: 12px; border-bottom: 1px solid #f3f4f6; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                    <input type="checkbox" class="group-checkbox" value="${group.group_id}" onchange="updateSelectedGroups()" ${isChecked} style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981;">
                    <span style="flex: 1; color: #333; font-size: 0.95em;">${group.name || 'Grupo sin nombre'}</span>
                </label>
            `;
            }).join('');
        }

        function toggleSelectAll() {
            const selectAll = document.getElementById('select-all').checked;
            const checkboxes = document.querySelectorAll('.group-checkbox');
            
            checkboxes.forEach(cb => {
                // Solo marcar/desmarcar los checkboxes visibles (no filtrados)
                if (cb.closest('label').style.display !== 'none') {
                    cb.checked = selectAll;
                }
            });
            
            updateSelectedGroups();
        }

        function updateSelectedGroups() {
            const checkboxes = document.querySelectorAll('.group-checkbox:checked');
            selectedGroups = Array.from(checkboxes).map(cb => cb.value);
            console.log('Grupos seleccionados:', selectedGroups.length);
            
            // Actualizar el display del selector
            updateGroupsDisplay();
        }

        function toggleGroupsDropdown() {
            const dropdown = document.getElementById('groups-dropdown-menu');
            const isVisible = dropdown.style.display === 'block';
            dropdown.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                document.getElementById('search-groups').value = '';
                filterGroups();
            }
        }

        function updateGroupsDisplay() {
            const placeholder = document.getElementById('groups-placeholder');
            const tagsContainer = document.getElementById('groups-selected-tags');
            const clearAllBtn = document.getElementById('clear-all-groups-btn');
            const saveBtn = document.getElementById('save-groups-btn');
            
            if (selectedGroups.length === 0) {
                placeholder.style.display = 'block';
                tagsContainer.style.display = 'none';
                clearAllBtn.style.display = 'none';
                saveBtn.style.display = 'none';
            } else {
                placeholder.style.display = 'none';
                tagsContainer.style.display = 'flex';
                clearAllBtn.style.display = 'block';
                saveBtn.style.display = 'block';
                
                // Crear los tags para cada grupo seleccionado
                tagsContainer.innerHTML = selectedGroups.map(id => {
                    const group = allGroups.find(g => g.group_id === id);
                    const groupName = group ? group.name : id;
                    
                    return `
                        <div style="display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px; background: #d1fae5; border: 2px solid #10b981; border-radius: 8px; font-size: 0.95em; color: #065f46;">
                            <span>${groupName}</span>
                            <button onclick="removeGroup(event, '${id}')" style="background: none; border: none; cursor: pointer; font-size: 1.1em; color: #065f46; padding: 0; display: flex; align-items: center; font-weight: bold;" onmouseover="this.style.color='#dc2626'" onmouseout="this.style.color='#065f46'">
                                √ó
                            </button>
                        </div>
                    `;
                }).join('');
            }
        }

        function removeGroup(event, groupId) {
            event.stopPropagation();
            
            // Remover el grupo de la lista de seleccionados
            selectedGroups = selectedGroups.filter(id => id !== groupId);
            
            // Desmarcar el checkbox correspondiente
            const checkbox = document.querySelector(`.group-checkbox[value="${groupId}"]`);
            if (checkbox) {
                checkbox.checked = false;
            }
            
            // Actualizar el display
            updateGroupsDisplay();
            
            // Actualizar el checkbox "Select All" si es necesario
            updateSelectAllCheckbox();
        }

        function clearAllGroups(event) {
            event.stopPropagation();
            
            if (confirm('¬øDeseas eliminar todos los grupos seleccionados?')) {
                // Limpiar la lista de grupos seleccionados
                selectedGroups = [];
                
                // Desmarcar todos los checkboxes
                document.querySelectorAll('.group-checkbox').forEach(cb => {
                    cb.checked = false;
                });
                
                // Desmarcar el "Select All"
                const selectAllCheckbox = document.getElementById('select-all');
                if (selectAllCheckbox) {
                    selectAllCheckbox.checked = false;
                }
                
                // Actualizar el display
                updateGroupsDisplay();
            }
        }

        function updateSelectAllCheckbox() {
            const selectAllCheckbox = document.getElementById('select-all');
            const allCheckboxes = document.querySelectorAll('.group-checkbox');
            const checkedCheckboxes = document.querySelectorAll('.group-checkbox:checked');
            
            if (selectAllCheckbox && allCheckboxes.length > 0) {
                selectAllCheckbox.checked = allCheckboxes.length === checkedCheckboxes.length;
            }
        }

        async function loadTemplates() {
            try {
                const response = await fetch('/api/templates');
                const data = await response.json();
                
                if (data.success) {
                    displayTemplates(data.templates);
                }
            } catch (error) {
                console.error('Error cargando templates:', error);
            }
        }

        function displayTemplates(templates) {
            const container = document.getElementById('templates-list');
            
            if (templates.length === 0) {
                container.innerHTML = '<p style="color: #666;">No hay templates</p>';
                return;
            }

            container.innerHTML = templates.map(template => `
                <div class="template-item" onclick="useTemplate(${template.id})">
                    <div class="template-name">${template.name}</div>
                    <div class="template-preview">${template.message}</div>
                </div>
            `).join('');
        }

        function useTemplate(templateId) {
            fetch(`/api/templates`)
                .then(res => res.json())
                .then(data => {
                    const template = data.templates.find(t => t.id === templateId);
                    if (template) {
                        document.getElementById('message').value = template.message;
                    }
                });
        }

        async function sendCampaign() {
            // Obtener el modo seleccionado (numbers, groups, contacts)
            const selectedMode = document.querySelector('input[name="send-mode"]:checked').value;
            
            let recipients = [];
            let message = '';
            
            // Validar y obtener datos seg√∫n el modo seleccionado
            if (selectedMode === 'numbers') {
                // Obtener n√∫meros de los tags
                if (selectedNumbers.length === 0) {
                    showStatus('error', 'Por favor agrega al menos un n√∫mero');
                    return;
                }
                recipients = selectedNumbers;
                message = document.getElementById('message-numbers').value.trim();
            } else if (selectedMode === 'groups') {
                if (selectedGroups.length === 0) {
                    showStatus('error', 'Por favor selecciona al menos un grupo');
                    return;
                }
                recipients = selectedGroups;
                message = document.getElementById('message-groups').value.trim();
            } else if (selectedMode === 'contacts') {
                if (selectedContacts.length === 0) {
                    showStatus('error', 'Por favor selecciona al menos un contacto');
                    return;
                }
                recipients = selectedContacts;
                message = document.getElementById('message-contacts').value.trim();
            }

            if (!message) {
                showStatus('error', 'Por favor escribe un mensaje');
                return;
            }

            // Obtener configuraci√≥n seg√∫n el modo
            const delayMinId = selectedMode === 'numbers' ? 'delay-min' : `delay-min-${selectedMode}`;
            const delayMaxId = selectedMode === 'numbers' ? 'delay-max' : `delay-max-${selectedMode}`;
            const batchSizeId = selectedMode === 'numbers' ? 'batch-size' : `batch-size-${selectedMode}`;
            const batchDelayId = selectedMode === 'numbers' ? 'batch-delay' : `batch-delay-${selectedMode}`;

            const config = {
                delays: {
                    min: parseInt(document.getElementById(delayMinId)?.value || 5),
                    max: parseInt(document.getElementById(delayMaxId)?.value || 15)
                },
                batchSize: parseInt(document.getElementById(batchSizeId)?.value || 50),
                batchDelay: parseInt(document.getElementById(batchDelayId)?.value || 30)
            };

            try {
                showStatus('info', 'üöÄ Iniciando campa√±a...');
                document.getElementById('campaign-controls').style.display = 'flex';

                // Los n√∫meros ya est√°n guardados tal como el usuario los escribi√≥
                // Solo limpiarlos de caracteres no num√©ricos
                let formattedRecipients = recipients;
                if (selectedMode === 'numbers') {
                    console.log('N√∫meros originales:', recipients);
                    
                    formattedRecipients = recipients.map(num => {
                        // Limpiar el n√∫mero (solo d√≠gitos)
                        const cleanNum = num.replace(/\D/g, '');
                        return cleanNum;
                    });
                    
                    console.log('N√∫meros a enviar:', formattedRecipients);
                }

                const payload = {
                    phone,
                    message,
                    config,
                    mode: selectedMode
                };

                // Agregar recipients seg√∫n el modo
                if (selectedMode === 'numbers') {
                    payload.numbers = formattedRecipients;
                } else if (selectedMode === 'groups') {
                    payload.groupIds = recipients;
                } else if (selectedMode === 'contacts') {
                    payload.contactIds = recipients;
                }

                console.log('Enviando campa√±a:', payload);

                const response = await fetch('/api/campaigns/send', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                
                if (result.success) {
                    showStatus('success', '‚úÖ Campa√±a iniciada exitosamente');
                    setTimeout(() => {
                        showStatus('info', 'üì§ Enviando mensajes...');
                    }, 1000);
                } else {
                    showStatus('error', result.message || 'Error al iniciar campa√±a');
                    document.getElementById('campaign-controls').style.display = 'none';
                }
            } catch (error) {
                console.error('Error al enviar campa√±a:', error);
                showStatus('error', 'Error: ' + error.message);
                document.getElementById('campaign-controls').style.display = 'none';
            }
        }

        function pauseCampaign() {
            showStatus('info', '‚è∏Ô∏è Pausando campa√±a...');
            // Implementar l√≥gica de pausa
        }

        function stopCampaign() {
            if (confirm('¬øEst√°s seguro de que quieres detener la campa√±a?')) {
                showStatus('info', 'üõë Deteniendo campa√±a...');
                campaignRunning = false;
                document.getElementById('campaign-controls').style.display = 'none';
            }
        }

        function showStatus(type, message) {
            const statusDiv = document.getElementById('status-message');
            statusDiv.className = 'status-message ' + type;
            statusDiv.textContent = message;
        }

        function goBack() {
            window.location.href = `/dashboard?phone=${encodeURIComponent(phone)}`;
        }

        function showNewTemplateModal() {
            const name = prompt('Nombre del template:');
            if (!name) return;

            const message = prompt('Mensaje del template:');
            if (!message) return;

            const category = prompt('Categor√≠a (opcional):', 'general');

            fetch('/api/templates', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, message, category: category || 'general' })
            })
            .then(res => res.json())
            .then(result => {
                if (result.success) {
                    alert('Template creado exitosamente');
                    loadTemplates();
                } else {
                    alert('Error: ' + result.error);
                }
            });
        }

        async function loadScheduledCampaigns() {
            try {
                const response = await fetch(`/api/campaigns/scheduled?phone=${phone}`);
                const data = await response.json();
                
                if (data.success && data.campaigns.length > 0) {
                    displayScheduledCampaigns(data.campaigns);
                }

                const pausedResponse = await fetch(`/api/campaigns/paused?phone=${phone}`);
                const pausedData = await pausedResponse.json();
                
                if (pausedData.success && pausedData.campaigns.length > 0) {
                    displayPausedCampaigns(pausedData.campaigns);
                }
            } catch (error) {
                console.error('Error cargando campa√±as:', error);
            }
        }

        function displayScheduledCampaigns(campaigns) {
            const container = document.getElementById('scheduled-campaigns-list');
            container.innerHTML = campaigns.map(campaign => `
                <div style="padding: 15px; border-bottom: 1px solid #e5e7eb; background: #f9fafb; margin-bottom: 10px; border-radius: 8px;">
                    <div style="font-weight: bold; margin-bottom: 5px;">${campaign.name}</div>
                    <div style="color: #666; font-size: 0.9em;">
                        üìÖ ${new Date(campaign.scheduled_at).toLocaleString()}
                    </div>
                    <div style="color: #666; font-size: 0.9em;">
                        üìä ${JSON.parse(campaign.group_ids).length} grupos
                    </div>
                    <button onclick="deleteCampaign(${campaign.id})" style="margin-top: 10px; padding: 5px 15px; background: #ef4444; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        üóëÔ∏è Eliminar
                    </button>
                </div>
            `).join('');
        }

        function displayPausedCampaigns(campaigns) {
            const container = document.getElementById('paused-campaigns-list');
            container.innerHTML = campaigns.map(campaign => `
                <div style="padding: 15px; border-bottom: 1px solid #e5e7eb; background: #fef3c7; margin-bottom: 10px; border-radius: 8px;">
                    <div style="font-weight: bold; margin-bottom: 5px;">${campaign.name}</div>
                    <div style="color: #666; font-size: 0.9em;">
                        üìä ${JSON.parse(campaign.group_ids).length} grupos
                    </div>
                    <div style="margin-top: 10px; display: flex; gap: 10px;">
                        <button onclick="resumeCampaign(${campaign.id})" style="padding: 5px 15px; background: #10b981; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            ‚ñ∂Ô∏è Reanudar
                        </button>
                        <button onclick="deleteCampaign(${campaign.id})" style="padding: 5px 15px; background: #ef4444; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            üóëÔ∏è Eliminar
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function showScheduleCampaignModal() {
            alert('Funcionalidad de programaci√≥n en desarrollo');
        }

        async function deleteCampaign(id) {
            if (!confirm('¬øEliminar esta campa√±a?')) return;

            try {
                const response = await fetch(`/api/campaigns/${id}`, { method: 'DELETE' });
                const result = await response.json();
                
                if (result.success) {
                    alert('Campa√±a eliminada');
                    loadScheduledCampaigns();
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function resumeCampaign(id) {
            try {
                const response = await fetch(`/api/campaigns/${id}/resume`, { method: 'POST' });
                const result = await response.json();
                
                if (result.success) {
                    alert('Campa√±a reanudada');
                    loadScheduledCampaigns();
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        function loadStatistics() {
            // Cargar estad√≠sticas desde el servidor
            console.log('Cargando estad√≠sticas...');
        }

        // Funciones para Campaign Numbers
        function toggleCampaignNumbersMenu() {
            const dropdown = document.getElementById('campaign-numbers-dropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        function showAddCampaignNumberModal(event) {
            if (event) event.stopPropagation();
            
            const countryCode = document.getElementById('selected-code').textContent;
            const numbersText = selectedNumbers.map(num => `${countryCode} ${num}`).join('\n');
            
            document.getElementById('campaign-numbers-content').value = numbersText;
            document.getElementById('campaign-numbers-dropdown').style.display = 'none';
            document.getElementById('add-campaign-numbers-modal').style.display = 'flex';
        }

        function closeAddCampaignNumbersModal() {
            document.getElementById('add-campaign-numbers-modal').style.display = 'none';
            document.getElementById('campaign-numbers-content').value = '';
            document.getElementById('campaign-numbers-name').value = '';
        }

        function saveCampaignNumbers() {
            const content = document.getElementById('campaign-numbers-content').value.trim();
            const name = document.getElementById('campaign-numbers-name').value.trim();
            
            if (!content) {
                alert('Por favor escribe el contenido de la plantilla');
                return;
            }
            
            if (!name) {
                alert('Por favor escribe un nombre para la plantilla');
                return;
            }
            
            // Aqu√≠ puedes agregar la l√≥gica para guardar en el servidor
            fetch('/api/campaign-numbers', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    name: name, 
                    content: content,
                    phone: phone
                })
            })
            .then(res => res.json())
            .then(result => {
                if (result.success) {
                    alert('‚úÖ Campaign Numbers guardado exitosamente');
                    closeAddCampaignNumbersModal();
                    // Recargar la lista de campaign numbers
                    loadCampaignNumbers();
                } else {
                    alert('‚ùå Error: ' + result.error);
                }
            })
            .catch(error => {
                alert('‚ùå Error al guardar: ' + error.message);
            });
        }

        function loadCampaignNumbers() {
            // Funci√≥n para cargar la lista de campaign numbers guardados
            // Se puede implementar cuando tengas el endpoint del servidor
            console.log('Cargando campaign numbers...');
        }

        // Cerrar el men√∫ de Campaign Numbers si se hace clic fuera de √©l
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('campaign-numbers-dropdown');
            const btn = document.getElementById('campaign-numbers-btn');
            
            if (dropdown && btn && !dropdown.contains(event.target) && !btn.contains(event.target)) {
                dropdown.style.display = 'none';
            }

            // Cerrar el men√∫ de Campaign Groups
            const dropdownGroups = document.getElementById('campaign-groups-dropdown');
            const btnGroups = document.getElementById('campaign-groups-btn');
            
            if (dropdownGroups && btnGroups && !dropdownGroups.contains(event.target) && !btnGroups.contains(event.target)) {
                dropdownGroups.style.display = 'none';
            }

            // Cerrar el men√∫ de Template Groups
            const dropdownTemplateGroups = document.getElementById('template-groups-dropdown');
            const btnTemplateGroups = document.getElementById('template-groups-btn');
            
            if (dropdownTemplateGroups && btnTemplateGroups && !dropdownTemplateGroups.contains(event.target) && !btnTemplateGroups.contains(event.target)) {
                dropdownTemplateGroups.style.display = 'none';
            }

            // Cerrar el dropdown de grupos
            const groupsDropdown = document.getElementById('groups-dropdown-menu');
            const groupsBtn = document.getElementById('groups-selector-btn');
            
            if (groupsDropdown && groupsBtn && !groupsDropdown.contains(event.target) && !groupsBtn.contains(event.target)) {
                groupsDropdown.style.display = 'none';
            }
        });

        // Funciones para mostrar/ocultar opciones avanzadas
        function toggleDelayOptions() {
            const checkbox = document.getElementById('enable-delays');
            const options = document.getElementById('delay-options');
            options.style.display = checkbox.checked ? 'block' : 'none';
        }

        function toggleBatchOptions() {
            const checkbox = document.getElementById('enable-batches');
            const options = document.getElementById('batch-options');
            options.style.display = checkbox.checked ? 'block' : 'none';
        }

        function toggleScheduleOptions() {
            const checkbox = document.getElementById('enable-schedule');
            const options = document.getElementById('schedule-options');
            
            if (checkbox.checked) {
                options.style.display = 'block';
                
                // Obtener fecha y hora actual
                const now = new Date();
                
                // Formatear fecha (YYYY-MM-DD)
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const dateString = `${year}-${month}-${day}`;
                
                // Formatear hora (HH:MM)
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const timeString = `${hours}:${minutes}`;
                
                // Establecer valores en los inputs
                document.getElementById('schedule-date').value = dateString;
                document.getElementById('schedule-time').value = timeString;
            } else {
                options.style.display = 'none';
            }
        }

        function toggleUpcomingCampaigns() {
            const dropdown = document.getElementById('upcoming-campaigns-dropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        function togglePausedCampaigns() {
            const dropdown = document.getElementById('paused-campaigns-dropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        // Cerrar los dropdowns de campa√±as al hacer clic fuera
        document.addEventListener('click', function(event) {
            const upcomingDropdown = document.getElementById('upcoming-campaigns-dropdown');
            const upcomingBtn = document.getElementById('upcoming-campaigns-btn');
            
            if (upcomingDropdown && upcomingBtn && !upcomingDropdown.contains(event.target) && !upcomingBtn.contains(event.target)) {
                upcomingDropdown.style.display = 'none';
            }

            const pausedDropdown = document.getElementById('paused-campaigns-dropdown');
            const pausedBtn = document.getElementById('paused-campaigns-btn');
            
            if (pausedDropdown && pausedBtn && !pausedDropdown.contains(event.target) && !pausedBtn.contains(event.target)) {
                pausedDropdown.style.display = 'none';
            }
        });

        // Funciones para el slider de delay
        function updateSliderValue() {
            const slider = document.getElementById('delay-slider');
            const input = document.getElementById('delay-slider-value');
            input.value = parseInt(slider.value);
            
            // Actualizar el gradiente del slider
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }

        function updateSliderFromInput() {
            const slider = document.getElementById('delay-slider');
            const input = document.getElementById('delay-slider-value');
            
            // Validar y limitar el valor
            let value = parseInt(input.value) || 1;
            if (value < 1) value = 1;
            if (value > 60) value = 60;
            
            input.value = value;
            slider.value = value;
            
            // Actualizar el gradiente del slider
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }

        function toggleDelayMode() {
            const mode = document.querySelector('input[name="delay-mode"]:checked').value;
            const customOption = document.getElementById('custom-option');
            const sliderOption = document.getElementById('slider-option');
            const delaySlider = document.getElementById('delay-slider');
            const delaySliderValue = document.getElementById('delay-slider-value');
            
            // Mostrar/ocultar opciones seg√∫n el modo seleccionado
            if (mode === 'custom') {
                customOption.style.display = 'block';
                sliderOption.style.display = 'flex';
                // Deshabilitar el slider cuando est√° en modo personalizado
                delaySlider.disabled = true;
                delaySliderValue.disabled = true;
                sliderOption.style.opacity = '0.5';
                sliderOption.style.pointerEvents = 'none';
            } else if (mode === 'slider') {
                customOption.style.display = 'none';
                sliderOption.style.display = 'flex';
                // Habilitar el slider cuando est√° en modo fijo
                delaySlider.disabled = false;
                delaySliderValue.disabled = false;
                sliderOption.style.opacity = '1';
                sliderOption.style.pointerEvents = 'auto';
            } else {
                customOption.style.display = 'none';
                sliderOption.style.display = 'none';
            }
        }

        // Funciones para el slider de tama√±o de lote
        function updateBatchSizeValue() {
            const slider = document.getElementById('batch-size-slider');
            const input = document.getElementById('batch-size');
            input.value = parseInt(slider.value);
            
            // Actualizar el gradiente del slider
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }

        function updateBatchSizeFromInput() {
            const slider = document.getElementById('batch-size-slider');
            const input = document.getElementById('batch-size');
            
            // Validar y limitar el valor
            let value = parseInt(input.value) || 10;
            if (value < 10) value = 10;
            if (value > 50) value = 50;
            
            input.value = value;
            slider.value = value;
            
            // Actualizar el gradiente del slider
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }

        // Funciones para el slider de pausa entre lotes
        function updateBatchDelayValue() {
            const slider = document.getElementById('batch-delay-slider');
            const input = document.getElementById('batch-delay');
            input.value = parseInt(slider.value);
            
            // Actualizar el gradiente del slider
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }

        function updateBatchDelayFromInput() {
            const slider = document.getElementById('batch-delay-slider');
            const input = document.getElementById('batch-delay');
            
            // Validar y limitar el valor
            let value = parseInt(input.value) || 5;
            if (value < 5) value = 5;
            if (value > 50) value = 50;
            
            input.value = value;
            slider.value = value;
            
            // Actualizar el gradiente del slider
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }

        // ============================================
        // FUNCIONES PARA GROUPS
        // ============================================

        function formatTextGroups(type) {
            const textarea = document.getElementById('message-groups');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            if (!selectedText) {
                alert('Por favor selecciona el texto que deseas formatear');
                return;
            }
            
            let formattedText = '';
            switch(type) {
                case 'bold':
                    formattedText = `*${selectedText}*`;
                    break;
                case 'italic':
                    formattedText = `_${selectedText}_`;
                    break;
                case 'strike':
                    formattedText = `~${selectedText}~`;
                    break;
                case 'code':
                    formattedText = `\`${selectedText}\``;
                    break;
            }
            
            textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
            textarea.focus();
            textarea.setSelectionRange(start, start + formattedText.length);
        }

        function attachFileGroups() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*,video/*,application/pdf,.doc,.docx';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    alert(`Archivo seleccionado: ${file.name}\n(Funcionalidad de env√≠o en desarrollo)`);
                }
            };
            input.click();
        }

        function toggleTemplateMenuGroups() {
            const dropdown = document.getElementById('template-groups-dropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        function showAddTemplateModalGroups() {
            document.getElementById('add-template-modal').style.display = 'flex';
            document.getElementById('template-groups-dropdown').style.display = 'none';
        }

        function toggleCampaignGroupsMenu() {
            const dropdown = document.getElementById('campaign-groups-dropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        function showAddCampaignGroupModal(event) {
            if (event) {
                event.stopPropagation();
            }
            
            if (selectedGroups.length === 0) {
                alert('Por favor selecciona al menos un grupo');
                return;
            }
            
            const selectedGroupsText = selectedGroups.map(id => {
                const group = allGroups.find(g => g.group_id === id);
                return group ? group.name : id;
            }).join('\n');
            
            document.getElementById('campaign-groups-content').value = selectedGroupsText;
            document.getElementById('campaign-groups-dropdown').style.display = 'none';
            document.getElementById('add-campaign-groups-modal').style.display = 'flex';
        }

        function closeAddCampaignGroupModal() {
            document.getElementById('add-campaign-groups-modal').style.display = 'none';
            document.getElementById('campaign-groups-content').value = '';
            document.getElementById('campaign-groups-name').value = '';
        }

        function saveCampaignGroups() {
            const content = document.getElementById('campaign-groups-content').value.trim();
            const name = document.getElementById('campaign-groups-name').value.trim();
            
            if (!content) {
                alert('Por favor selecciona grupos');
                return;
            }
            
            if (!name) {
                alert('Por favor escribe un nombre para la campa√±a');
                return;
            }
            
            fetch('/api/campaign-groups', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    name: name, 
                    groups: selectedGroups,
                    phone: phone
                })
            })
            .then(res => res.json())
            .then(result => {
                if (result.success) {
                    alert('‚úÖ Campaign Groups guardado exitosamente');
                    closeAddCampaignGroupModal();
                    loadCampaignGroups();
                } else {
                    alert('‚ùå Error: ' + result.error);
                }
            })
            .catch(error => {
                alert('‚ùå Error al guardar: ' + error.message);
            });
        }

        function loadCampaignGroups() {
            console.log('Cargando campaign groups...');
        }

        async function sendCampaignGroups() {
            if (selectedGroups.length === 0) {
                showStatusGroups('error', 'Por favor selecciona al menos un grupo');
                return;
            }

            const message = document.getElementById('message-groups').value.trim();
            if (!message) {
                showStatusGroups('error', 'Por favor escribe un mensaje');
                return;
            }

            const config = {
                delays: {
                    min: parseInt(document.getElementById('delay-min-groups').value),
                    max: parseInt(document.getElementById('delay-max-groups').value)
                },
                batchSize: parseInt(document.getElementById('batch-size-groups').value),
                batchDelay: parseInt(document.getElementById('batch-delay-groups').value)
            };

            try {
                showStatusGroups('info', 'üöÄ Iniciando campa√±a...');
                document.getElementById('campaign-controls-groups').style.display = 'flex';

                const response = await fetch('/api/campaigns/send', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        phone,
                        groupIds: selectedGroups,
                        message,
                        config
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    showStatusGroups('info', 'üì§ Campa√±a en progreso...');
                } else {
                    showStatusGroups('error', result.message);
                    document.getElementById('campaign-controls-groups').style.display = 'none';
                }
            } catch (error) {
                showStatusGroups('error', 'Error: ' + error.message);
                document.getElementById('campaign-controls-groups').style.display = 'none';
            }
        }

        function pauseCampaignGroups() {
            showStatusGroups('info', '‚è∏Ô∏è Pausando campa√±a...');
        }

        function stopCampaignGroups() {
            if (confirm('¬øEst√°s seguro de que quieres detener la campa√±a?')) {
                showStatusGroups('info', 'üõë Deteniendo campa√±a...');
                document.getElementById('campaign-controls-groups').style.display = 'none';
            }
        }

        function showStatusGroups(type, message) {
            const statusDiv = document.getElementById('status-message-groups');
            statusDiv.className = 'status-message ' + type;
            statusDiv.textContent = message;
        }

        function toggleDelayOptionsGroups() {
            const checkbox = document.getElementById('enable-delays-groups');
            const options = document.getElementById('delay-options-groups');
            options.style.display = checkbox.checked ? 'block' : 'none';
        }

        function toggleBatchOptionsGroups() {
            const checkbox = document.getElementById('enable-batches-groups');
            const options = document.getElementById('batch-options-groups');
            options.style.display = checkbox.checked ? 'block' : 'none';
        }

        function toggleScheduleOptionsGroups() {
            const checkbox = document.getElementById('enable-schedule-groups');
            const options = document.getElementById('schedule-options-groups');
            
            if (checkbox.checked) {
                options.style.display = 'block';
                
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const dateString = `${year}-${month}-${day}`;
                
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const timeString = `${hours}:${minutes}`;
                
                document.getElementById('schedule-date-groups').value = dateString;
                document.getElementById('schedule-time-groups').value = timeString;
            } else {
                options.style.display = 'none';
            }
        }

        function toggleUpcomingCampaignsGroups() {
            const dropdown = document.getElementById('upcoming-campaigns-groups-dropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        function togglePausedCampaignsGroups() {
            const dropdown = document.getElementById('paused-campaigns-groups-dropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        function updateSliderValueGroups() {
            const slider = document.getElementById('delay-slider-groups');
            const input = document.getElementById('delay-slider-value-groups');
            input.value = parseInt(slider.value);
            
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }

        function updateSliderFromInputGroups() {
            const slider = document.getElementById('delay-slider-groups');
            const input = document.getElementById('delay-slider-value-groups');
            
            let value = parseInt(input.value) || 1;
            if (value < 1) value = 1;
            if (value > 60) value = 60;
            
            input.value = value;
            slider.value = value;
            
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }

        function toggleDelayModeGroups() {
            const mode = document.querySelector('input[name="delay-mode-groups"]:checked').value;
            const customOption = document.getElementById('custom-option-groups');
            const sliderOption = document.getElementById('slider-option-groups');
            const delaySlider = document.getElementById('delay-slider-groups');
            const delaySliderValue = document.getElementById('delay-slider-value-groups');
            
            if (mode === 'custom') {
                customOption.style.display = 'block';
                sliderOption.style.display = 'flex';
                delaySlider.disabled = true;
                delaySliderValue.disabled = true;
                sliderOption.style.opacity = '0.5';
                sliderOption.style.pointerEvents = 'none';
            } else if (mode === 'slider') {
                customOption.style.display = 'none';
                sliderOption.style.display = 'flex';
                delaySlider.disabled = false;
                delaySliderValue.disabled = false;
                sliderOption.style.opacity = '1';
                sliderOption.style.pointerEvents = 'auto';
            } else {
                customOption.style.display = 'none';
                sliderOption.style.display = 'none';
            }
        }

        function updateBatchSizeValueGroups() {
            const slider = document.getElementById('batch-size-slider-groups');
            const input = document.getElementById('batch-size-groups');
            input.value = parseInt(slider.value);
            
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }

        function updateBatchSizeFromInputGroups() {
            const slider = document.getElementById('batch-size-slider-groups');
            const input = document.getElementById('batch-size-groups');
            
            let value = parseInt(input.value) || 10;
            if (value < 10) value = 10;
            if (value > 50) value = 50;
            
            input.value = value;
            slider.value = value;
            
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }

        function updateBatchDelayValueGroups() {
            const slider = document.getElementById('batch-delay-slider-groups');
            const input = document.getElementById('batch-delay-groups');
            input.value = parseInt(slider.value);
            
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }

        function updateBatchDelayFromInputGroups() {
            const slider = document.getElementById('batch-delay-slider-groups');
            const input = document.getElementById('batch-delay-groups');
            
            let value = parseInt(input.value) || 5;
            if (value < 5) value = 5;
            if (value > 50) value = 50;
            
            input.value = value;
            slider.value = value;
            
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }

        // ============================================
        // FUNCIONES PARA CONTACTS
        // ============================================

        let selectedContacts = [];
        let allContacts = [];

        function toggleContactsDropdown() {
            const dropdown = document.getElementById('contacts-dropdown-menu');
            const isVisible = dropdown.style.display === 'block';
            dropdown.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                document.getElementById('search-contacts').value = '';
                filterContacts();
            }
        }

        function filterContacts() {
            const searchTerm = document.getElementById('search-contacts').value.toLowerCase();
            const filtered = allContacts.filter(contact => 
                (contact.name || '').toLowerCase().includes(searchTerm)
            );
            displayContacts(filtered);
        }

        function displayContacts(contacts) {
            const container = document.getElementById('contacts-list');
            
            if (contacts.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">No hay contactos disponibles</p>';
                return;
            }

            container.innerHTML = contacts.map(contact => {
                const isChecked = selectedContacts.includes(contact.id) ? 'checked' : '';
                return `
                <label style="display: flex; align-items: center; gap: 10px; padding: 12px; border-bottom: 1px solid #f3f4f6; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                    <input type="checkbox" class="contact-checkbox" value="${contact.id}" onchange="updateSelectedContacts()" ${isChecked} style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981;">
                    <span style="flex: 1; color: #333; font-size: 0.95em;">${contact.name || 'Contacto sin nombre'}</span>
                </label>
            `;
            }).join('');
        }

        function toggleSelectAllContacts() {
            const selectAll = document.getElementById('select-all-contacts').checked;
            const checkboxes = document.querySelectorAll('.contact-checkbox');
            
            checkboxes.forEach(cb => {
                cb.checked = selectAll;
            });
            
            updateSelectedContacts();
        }

        function updateSelectedContacts() {
            const checkboxes = document.querySelectorAll('.contact-checkbox:checked');
            selectedContacts = Array.from(checkboxes).map(cb => cb.value);
            updateContactsDisplay();
        }

        function updateContactsDisplay() {
            const placeholder = document.getElementById('contacts-placeholder');
            const tagsContainer = document.getElementById('contacts-selected-tags');
            const clearAllBtn = document.getElementById('clear-all-contacts-btn');
            const saveBtn = document.getElementById('save-contacts-btn');
            
            if (selectedContacts.length === 0) {
                placeholder.style.display = 'block';
                tagsContainer.style.display = 'none';
                clearAllBtn.style.display = 'none';
                saveBtn.style.display = 'none';
            } else {
                placeholder.style.display = 'none';
                tagsContainer.style.display = 'flex';
                clearAllBtn.style.display = 'block';
                saveBtn.style.display = 'block';
                
                // Crear los tags para cada contacto seleccionado
                tagsContainer.innerHTML = selectedContacts.map(id => {
                    const contact = allContacts.find(c => c.id === id);
                    const contactName = contact ? contact.name : id;
                    
                    return `
                        <div style="display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px; background: #d1fae5; border: 2px solid #10b981; border-radius: 8px; font-size: 0.95em; color: #065f46;">
                            <span>${contactName}</span>
                            <button onclick="removeContact(event, '${id}')" style="background: none; border: none; cursor: pointer; font-size: 1.1em; color: #065f46; padding: 0; display: flex; align-items: center; font-weight: bold;" onmouseover="this.style.color='#dc2626'" onmouseout="this.style.color='#065f46'">
                                √ó
                            </button>
                        </div>
                    `;
                }).join('');
            }
        }

        function removeContact(event, contactId) {
            event.stopPropagation();
            
            // Remover el contacto de la lista de seleccionados
            selectedContacts = selectedContacts.filter(id => id !== contactId);
            
            // Desmarcar el checkbox correspondiente
            const checkbox = document.querySelector(`.contact-checkbox[value="${contactId}"]`);
            if (checkbox) {
                checkbox.checked = false;
            }
            
            // Actualizar el display
            updateContactsDisplay();
            
            // Actualizar el checkbox "Select All" si es necesario
            const allCheckboxes = document.querySelectorAll('.contact-checkbox');
            const checkedCheckboxes = document.querySelectorAll('.contact-checkbox:checked');
            const selectAllCheckbox = document.getElementById('select-all-contacts');
            if (selectAllCheckbox) {
                selectAllCheckbox.checked = allCheckboxes.length === checkedCheckboxes.length && allCheckboxes.length > 0;
            }
        }

        function clearAllContacts(event) {
            event.stopPropagation();
            
            if (confirm('¬øDeseas eliminar todos los contactos seleccionados?')) {
                // Desmarcar todos los checkboxes
                document.querySelectorAll('.contact-checkbox').forEach(cb => {
                    cb.checked = false;
                });
                
                // Desmarcar el "Select All"
                const selectAllCheckbox = document.getElementById('select-all-contacts');
                if (selectAllCheckbox) {
                    selectAllCheckbox.checked = false;
                }
                
                // Limpiar la lista de seleccionados
                selectedContacts = [];
                
                // Actualizar el display
                updateContactsDisplay();
            }
        }

        async function loadContacts() {
            // Simular carga de contactos
            allContacts = [
                { id: '1', name: 'Juan P√©rez' },
                { id: '2', name: 'Mar√≠a Garc√≠a' },
                { id: '3', name: 'Carlos L√≥pez' }
            ];
            displayContacts(allContacts);
        }

        function formatTextContacts(type) {
            const textarea = document.getElementById('message-contacts');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            if (!selectedText) {
                alert('Por favor selecciona el texto que deseas formatear');
                return;
            }
            
            let formattedText = '';
            switch(type) {
                case 'bold':
                    formattedText = `*${selectedText}*`;
                    break;
                case 'italic':
                    formattedText = `_${selectedText}_`;
                    break;
                case 'strike':
                    formattedText = `~${selectedText}~`;
                    break;
                case 'code':
                    formattedText = `\`${selectedText}\``;
                    break;
            }
            
            textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
            textarea.focus();
            textarea.setSelectionRange(start, start + formattedText.length);
        }

        function attachFileContacts() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*,video/*,application/pdf,.doc,.docx';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    alert(`Archivo seleccionado: ${file.name}\n(Funcionalidad de env√≠o en desarrollo)`);
                }
            };
            input.click();
        }

        function toggleTemplateMenuContacts() {
            const dropdown = document.getElementById('template-contacts-dropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        function showAddTemplateModalContacts() {
            document.getElementById('add-template-modal').style.display = 'flex';
            document.getElementById('template-contacts-dropdown').style.display = 'none';
        }

        function toggleCampaignContactsMenu(event) {
            if (event) event.stopPropagation();
            const dropdown = document.getElementById('campaign-contacts-dropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        function showAddCampaignContactModal(event) {
            if (event) event.stopPropagation();
            
            const selectedContactsText = selectedContacts.map(id => {
                const contact = allContacts.find(c => c.id === id);
                return contact ? contact.name : id;
            }).join('\n');
            
            // Aqu√≠ puedes abrir un modal para guardar la campa√±a
            alert('Funcionalidad de guardar Campaign Contacts en desarrollo\n\nContactos seleccionados:\n' + selectedContactsText);
        }

        async function sendCampaignContacts() {
            if (selectedContacts.length === 0) {
                showStatusContacts('error', 'Por favor selecciona al menos un contacto');
                return;
            }

            const message = document.getElementById('message-contacts').value.trim();
            if (!message) {
                showStatusContacts('error', 'Por favor escribe un mensaje');
                return;
            }

            showStatusContacts('info', 'üöÄ Iniciando campa√±a...');
        }

        function pauseCampaignContacts() {
            showStatusContacts('info', '‚è∏Ô∏è Pausando campa√±a...');
        }

        function stopCampaignContacts() {
            if (confirm('¬øEst√°s seguro de que quieres detener la campa√±a?')) {
                showStatusContacts('info', 'üõë Deteniendo campa√±a...');
                document.getElementById('campaign-controls-contacts').style.display = 'none';
            }
        }

        function showStatusContacts(type, message) {
            const statusDiv = document.getElementById('status-message-contacts');
            statusDiv.className = 'status-message ' + type;
            statusDiv.textContent = message;
        }

        function toggleDelayOptionsContacts() {
            const checkbox = document.getElementById('enable-delays-contacts');
            const options = document.getElementById('delay-options-contacts');
            options.style.display = checkbox.checked ? 'block' : 'none';
        }

        function toggleDelayModeContacts() {
            const mode = document.querySelector('input[name="delay-mode-contacts"]:checked').value;
            const customOption = document.getElementById('custom-option-contacts');
            const sliderOption = document.getElementById('slider-option-contacts');
            const delaySlider = document.getElementById('delay-slider-contacts');
            const delaySliderValue = document.getElementById('delay-slider-value-contacts');
            
            if (mode === 'custom') {
                customOption.style.display = 'block';
                sliderOption.style.display = 'flex';
                delaySlider.disabled = true;
                delaySliderValue.disabled = true;
                sliderOption.style.opacity = '0.5';
                sliderOption.style.pointerEvents = 'none';
            } else if (mode === 'slider') {
                customOption.style.display = 'none';
                sliderOption.style.display = 'flex';
                delaySlider.disabled = false;
                delaySliderValue.disabled = false;
                sliderOption.style.opacity = '1';
                sliderOption.style.pointerEvents = 'auto';
            } else {
                customOption.style.display = 'none';
                sliderOption.style.display = 'none';
            }
        }

        function updateSliderValueContacts() {
            const slider = document.getElementById('delay-slider-contacts');
            const input = document.getElementById('delay-slider-value-contacts');
            input.value = parseInt(slider.value);
            
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }

        function updateSliderFromInputContacts() {
            const slider = document.getElementById('delay-slider-contacts');
            const input = document.getElementById('delay-slider-value-contacts');
            
            let value = parseInt(input.value) || 1;
            if (value < 1) value = 1;
            if (value > 60) value = 60;
            
            input.value = value;
            slider.value = value;
            
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }

        function toggleBatchOptionsContacts() {
            const checkbox = document.getElementById('enable-batches-contacts');
            const options = document.getElementById('batch-options-contacts');
            options.style.display = checkbox.checked ? 'block' : 'none';
        }

        function updateBatchSizeValueContacts() {
            const slider = document.getElementById('batch-size-slider-contacts');
            const input = document.getElementById('batch-size-contacts');
            input.value = parseInt(slider.value);
            
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }

        function updateBatchSizeFromInputContacts() {
            const slider = document.getElementById('batch-size-slider-contacts');
            const input = document.getElementById('batch-size-contacts');
            
            let value = parseInt(input.value) || 10;
            if (value < 10) value = 10;
            if (value > 50) value = 50;
            
            input.value = value;
            slider.value = value;
            
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }

        function updateBatchDelayValueContacts() {
            const slider = document.getElementById('batch-delay-slider-contacts');
            const input = document.getElementById('batch-delay-contacts');
            input.value = parseInt(slider.value);
            
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }

        function updateBatchDelayFromInputContacts() {
            const slider = document.getElementById('batch-delay-slider-contacts');
            const input = document.getElementById('batch-delay-contacts');
            
            let value = parseInt(input.value) || 5;
            if (value < 5) value = 5;
            if (value > 50) value = 50;
            
            input.value = value;
            slider.value = value;
            
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }

        function toggleScheduleOptionsContacts() {
            const checkbox = document.getElementById('enable-schedule-contacts');
            const options = document.getElementById('schedule-options-contacts');
            
            if (checkbox.checked) {
                options.style.display = 'block';
                
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const dateString = `${year}-${month}-${day}`;
                
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const timeString = `${hours}:${minutes}`;
                
                document.getElementById('schedule-date-contacts').value = dateString;
                document.getElementById('schedule-time-contacts').value = timeString;
            } else {
                options.style.display = 'none';
            }
        }

        function toggleUpcomingCampaignsContacts() {
            const dropdown = document.getElementById('upcoming-campaigns-contacts-dropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        function togglePausedCampaignsContacts() {
            const dropdown = document.getElementById('paused-campaigns-contacts-dropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        // ============================================
        // FUNCIONES PARA CAMPAIGN GROUPS
        // ============================================

        function toggleCampaignGroupsMenu(event) {
            if (event) event.stopPropagation();
            const dropdown = document.getElementById('campaign-groups-dropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        function showAddCampaignGroupModal(event) {
            if (event) event.stopPropagation();
            
            const selectedGroupsText = selectedGroups.map(id => {
                const group = allGroups.find(g => g.id === id);
                return group ? group.name : id;
            }).join('\n');
            
            // Aqu√≠ puedes abrir un modal para guardar la campa√±a
            alert('Funcionalidad de guardar Campaign Groups en desarrollo\n\nGrupos seleccionados:\n' + selectedGroupsText);
        }

        // Cerrar el dropdown de Campaign Groups al hacer clic fuera
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('campaign-groups-dropdown');
            const btn = document.getElementById('campaign-groups-btn');
            
            if (dropdown && btn && !dropdown.contains(event.target) && !btn.contains(event.target)) {
                dropdown.style.display = 'none';
            }

            // Cerrar el dropdown de Campaign Contacts al hacer clic fuera
            const contactsDropdown = document.getElementById('campaign-contacts-dropdown');
            const contactsBtn = document.getElementById('campaign-contacts-btn');
            
            if (contactsDropdown && contactsBtn && !contactsDropdown.contains(event.target) && !contactsBtn.contains(event.target)) {
                contactsDropdown.style.display = 'none';
            }
        });
    </script>
</body>
</html>
