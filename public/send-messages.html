<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enviar Mensajes - WhatsApp Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        /* Asegurar que los emojis se muestren correctamente */
        .emoji, [id*="flag"], [id*="country"] {
            font-family: 'Segoe UI Emoji', 'Apple Color Emoji', 'Noto Color Emoji', 'Android Emoji', 'EmojiSymbols', sans-serif !important;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #333;
            font-size: 1.8em;
        }

        .btn-back {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .main-content {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .tabs-container {
            display: flex;
            background: #f3f4f6;
            border-bottom: 2px solid #e5e7eb;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab:hover {
            background: #e5e7eb;
            color: #333;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: bold;
        }

        .form-group select,
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1em;
        }

        .form-group textarea {
            min-height: 150px;
            resize: vertical;
            font-family: inherit;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
        }

        .number-input {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .number-input input {
            flex: 1;
        }

        .number-input span {
            color: #666;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.6);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }

        .template-list {
            max-height: 300px;
            overflow-y: auto;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 10px;
        }

        .template-item {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
            cursor: pointer;
            transition: background 0.2s;
        }

        .template-item:hover {
            background: #f3f4f6;
        }

        .template-item:last-child {
            border-bottom: none;
        }

        .template-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .template-preview {
            color: #666;
            font-size: 0.9em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-weight: bold;
            display: none;
        }

        .status-message.success {
            background: #d1fae5;
            color: #065f46;
            display: block;
        }

        .status-message.error {
            background: #fee2e2;
            color: #991b1b;
            display: block;
        }

        .status-message.info {
            background: #dbeafe;
            color: #1e40af;
            display: block;
        }

        .campaign-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .campaign-controls button {
            flex: 1;
        }

        .btn-pause {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .btn-stop {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .options-section {
            border-top: 2px solid #e5e7eb;
            padding-top: 20px;
            margin-top: 20px;
        }

        .options-section h3 {
            color: #333;
            margin-bottom: 15px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* Estilos personalizados para el slider */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            height: 18px;
            border-radius: 10px;
            outline: none;
            background: transparent;
            padding: 4px 0;
        }

        /* Track para WebKit (Chrome, Safari, Edge) */
        input[type="range"]::-webkit-slider-runnable-track {
            height: 18px;
            border-radius: 10px;
        }

        /* Thumb para WebKit */
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #10b981;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: all 0.2s ease;
            margin-top: 0px;
            position: relative;
            z-index: 2;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
        }

        input[type="range"]::-webkit-slider-thumb:active {
            transform: scale(1.1);
        }

        /* Track para Firefox */
        input[type="range"]::-moz-range-track {
            height: 18px;
            border-radius: 10px;
            background: #e5e7eb;
        }

        /* Thumb para Firefox */
        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #10b981;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: all 0.2s ease;
        }

        input[type="range"]::-moz-range-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
        }

        input[type="range"]::-moz-range-thumb:active {
            transform: scale(1.1);
        }

        /* Progress para Firefox */
        input[type="range"]::-moz-range-progress {
            background: #10b981;
            height: 18px;
            border-radius: 10px;
        }

        /* Mantener las flechitas de los inputs num√©ricos */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì§ Enviar Mensajes Masivos</h1>
            <button class="btn-back" onclick="goBack()">‚Üê Volver al Dashboard</button>
        </div>

        <div class="main-content">
            <!-- Tabs -->
            <div class="tabs-container">
                <div class="tab active" onclick="switchTab('config')">
                    üìù Configurar Mensaje
                </div>
                <div class="tab" onclick="switchTab('templates')">
                    üìã Templates
                </div>
                <div class="tab" onclick="switchTab('campaigns')">
                    üìÖ Campa√±as Programadas
                </div>
                <div class="tab" onclick="switchTab('stats')">
                    üìä Estad√≠sticas
                </div>
            </div>

            <!-- Tab Content: Configurar Mensaje -->
            <div id="tab-config" class="tab-content active">
                <h2>Configurar Mensaje</h2>

                <!-- Radio Buttons para seleccionar modo -->
                <div style="display: flex; gap: 30px; margin-bottom: 30px; padding: 20px; background: #f9fafb; border-radius: 10px;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 1.1em; font-weight: bold;">
                        <input type="radio" name="send-mode" value="numbers" onchange="changeSendMode('numbers')">
                        üì± Numbers
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 1.1em; font-weight: bold;">
                        <input type="radio" name="send-mode" value="groups" checked onchange="changeSendMode('groups')">
                        üë• Groups
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 1.1em; font-weight: bold;">
                        <input type="radio" name="send-mode" value="contacts" onchange="changeSendMode('contacts')">
                        üìá Contacts
                    </label>
                </div>

                <!-- Secci√≥n para Numbers -->
                <div id="section-numbers" style="display: none;">
                    <!-- Layout de dos columnas -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        
                        <!-- COLUMNA IZQUIERDA -->
                        <div>
                            <div class="form-group">
                                <label>Ingrese n√∫meros para enviar mensajes</label>
                                
                                <!-- Contenedor tipo textarea con todo integrado -->
                                <div style="border: 2px solid #d1d5db; border-radius: 10px; background: white; overflow: hidden;">
                            
                            <!-- Header con selector de pa√≠s -->
                            <div style="padding: 12px 15px; border-bottom: 1px solid #e5e7eb; background: #fafafa;">
                                <div style="position: relative; display: inline-block;">
                                    <div id="country-selector-btn" onclick="toggleCountryDropdown()" style="padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 0.95em;">
                                        <img id="selected-flag-img" src="https://flagcdn.com/w40/ca.png" alt="CA" style="width: 26px; height: 18px; border-radius: 2px; object-fit: cover; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                                        <span id="selected-code" style="color: #10b981; font-weight: bold;">+1</span>
                                        <span style="margin-left: 5px; color: #666; font-size: 0.8em;">‚ñº</span>
                                    </div>
                                    
                                    <!-- Dropdown de pa√≠ses -->
                                    <div id="country-dropdown" style="display: none; position: absolute; top: 100%; left: 0; width: 320px; background: white; border: 2px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); margin-top: 5px; z-index: 1000; max-height: 400px; overflow: hidden;">
                                        <!-- Barra de b√∫squeda -->
                                        <div style="padding: 10px; border-bottom: 1px solid #e5e7eb; background: #f9fafb;">
                                            <input type="text" id="country-search" placeholder="üîç Buscar pa√≠s..." style="width: 100%; padding: 8px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 0.9em;" oninput="filterCountries()" onclick="event.stopPropagation()">
                                        </div>
                                        
                                        <!-- Lista de pa√≠ses -->
                                        <div id="countries-list" style="max-height: 350px; overflow-y: auto;">
                                            <!-- Los pa√≠ses se cargar√°n aqu√≠ -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- √Årea de contenido con texto de ayuda y textarea -->
                            <div style="padding: 15px;">
                                <p style="color: #9ca3af; font-size: 0.9em; margin-bottom: 10px; line-height: 1.4;">
                                    Ingrese n√∫meros separados por coma o uno debajo del otro.<br>
                                    Ej. 51234567, 51765432
                                </p>
                                
                                <textarea id="numbers-input" placeholder="" style="width: 100%; min-height: 120px; font-family: monospace; padding: 0; border: none; font-size: 0.95em; background: transparent; resize: none; outline: none; color: #333;"></textarea>
                            </div>
                            
                            <!-- Footer con botones -->
                            <div style="padding: 12px 15px; border-top: 1px solid #e5e7eb; background: #fafafa; display: flex; gap: 10px; align-items: center; justify-content: space-between;">
                                <button onclick="showExampleNumbers()" style="display: flex; align-items: center; gap: 5px; padding: 8px 16px; background: white; border: 2px solid #10b981; color: #10b981; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9em;">
                                    üìã Ejemplo
                                </button>
                                
                                <div style="display: flex; gap: 10px;">
                                    <button onclick="uploadNumbersFile()" style="display: flex; align-items: center; gap: 5px; padding: 8px 16px; background: white; border: 2px solid #10b981; color: #10b981; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9em;">
                                        üì§ Subir Excel
                                    </button>
                                    
                                    <div style="position: relative;">
                                        <button onclick="toggleCampaignNumbersMenu()" id="campaign-numbers-btn" style="padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 6px; background: white; cursor: pointer; font-size: 0.9em; min-width: 180px; color: #666; display: flex; align-items: center; justify-content: space-between; gap: 8px;">
                                            <span>Campaign Numbers</span>
                                            <span style="font-size: 0.8em;">‚ñº</span>
                                        </button>
                                        
                                        <!-- Men√∫ desplegable de Campaign Numbers -->
                                        <div id="campaign-numbers-dropdown" style="display: none; position: absolute; bottom: 100%; right: 0; background: white; border: 2px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 250px; margin-bottom: 5px; z-index: 1000;">
                                            <div style="padding: 15px; color: #9ca3af; text-align: center; border-bottom: 1px solid #e5e7eb; font-size: 1.1em;">
                                                ¬°Nada que mostrar!
                                            </div>
                                            <div onclick="showAddCampaignNumberModal()" style="padding: 12px 15px; cursor: pointer; display: flex; align-items: center; gap: 8px; color: #10b981; font-weight: bold; transition: background 0.2s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='white'">
                                                üìã <span style="color: #10b981;">Add Template</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- √Årea de mensaje con opciones de formato -->
                    <div class="form-group" style="margin-top: 20px;">
                        <label>Introducir mensaje</label>
                        <div style="border: 2px solid #e5e7eb; border-radius: 8px; overflow: hidden;">
                            <!-- Barra de formato -->
                            <div style="background: #f9fafb; padding: 8px; border-bottom: 1px solid #e5e7eb; display: flex; gap: 10px; align-items: center;">
                                <button onclick="formatText('bold')" style="padding: 5px 10px; border: 1px solid #e5e7eb; background: white; border-radius: 4px; cursor: pointer; font-weight: bold;">*text*</button>
                                <button onclick="formatText('italic')" style="padding: 5px 10px; border: 1px solid #e5e7eb; background: white; border-radius: 4px; cursor: pointer; font-style: italic;">_text_</button>
                                <button onclick="formatText('strike')" style="padding: 5px 10px; border: 1px solid #e5e7eb; background: white; border-radius: 4px; cursor: pointer; text-decoration: line-through;">~text~</button>
                                <button onclick="formatText('code')" style="padding: 5px 10px; border: 1px solid #e5e7eb; background: white; border-radius: 4px; cursor: pointer; font-family: monospace;">`text`</button>
                                <span style="color: #999; margin-left: auto;">EMOJIS</span>
                            </div>
                            
                            <!-- √Årea de texto -->
                            <textarea id="message-numbers" placeholder="Escribe tu mensaje aqu√≠..." style="width: 100%; min-height: 150px; border: none; padding: 15px; font-size: 1em; resize: vertical; font-family: inherit;"></textarea>
                            
                            <!-- Barra inferior con clip y template -->
                            <div style="background: #f9fafb; padding: 10px; border-top: 1px solid #e5e7eb; display: flex; gap: 10px; align-items: center;">
                                <button onclick="attachFile()" style="padding: 8px 15px; border: 1px solid #e5e7eb; background: white; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 5px;">
                                    üìé
                                </button>
                                
                                <div style="position: relative;">
                                    <button onclick="toggleTemplateMenu()" id="template-btn" style="padding: 8px 15px; border: 1px solid #e5e7eb; background: white; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 5px;">
                                        Template ‚ñº
                                    </button>
                                    
                                    <!-- Men√∫ desplegable de templates -->
                                    <div id="template-dropdown" style="display: none; position: absolute; bottom: 100%; left: 0; background: white; border: 2px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 200px; margin-bottom: 5px; z-index: 1000;">
                                        <div style="padding: 10px; color: #666; text-align: center; border-bottom: 1px solid #e5e7eb;">
                                            ¬°Nada que mostrar!
                                        </div>
                                        <div onclick="showAddTemplateModal()" style="padding: 12px; cursor: pointer; display: flex; align-items: center; gap: 8px; color: #10b981; font-weight: bold; transition: background 0.2s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='white'">
                                            üìã Add Template
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bot√≥n Enviar Mensajes -->
                    <button class="btn-primary" onclick="sendCampaign()" style="width: 100%; margin-top: 20px;">
                        üì§ Enviar Mensajes
                    </button>
                    
                    <div class="campaign-controls" id="campaign-controls" style="display: none; margin-top: 10px;">
                        <button class="btn-primary btn-pause" onclick="pauseCampaign()" style="width: 100%; margin-bottom: 10px;">‚è∏Ô∏è Pausar</button>
                        <button class="btn-primary btn-stop" onclick="stopCampaign()" style="width: 100%;">üõë Detener</button>
                    </div>
                    
                    <div id="status-message" class="status-message"></div>
                    </div>
                    
                    <!-- COLUMNA DERECHA - Opciones Avanzadas -->
                    <div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 15px;">
                                <span style="font-size: 1.2em;">‚öôÔ∏è</span>
                                <span style="font-weight: bold; font-size: 1.1em;">Opciones Avanzadas</span>
                            </label>
                            
                            <div style="border: 2px solid #e5e7eb; border-radius: 10px; padding: 20px; background: white;">
                                
                                <!-- Agregar intervalos de tiempo -->
                                <div style="margin-bottom: 20px;">
                                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 15px; cursor: pointer;">
                                        <input type="checkbox" id="enable-delays" onchange="toggleDelayOptions()" style="width: 20px; height: 20px; cursor: pointer; accent-color: #10b981;">
                                        <span style="font-weight: 600; color: #333; font-size: 1.05em;">Agregar un intervalo de tiempo entre mensajes</span>
                                    </label>
                                    
                                    <div id="delay-options" style="margin-top: 15px; display: none; padding: 15px; background: #f9fafb; border-radius: 8px;">
                                        <!-- Opci√≥n con Slider -->
                                        <div style="margin-bottom: 20px;">
                                            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer;">
                                                <input type="radio" name="delay-mode" value="slider" checked onchange="toggleDelayMode()" style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981;">
                                                <span style="font-weight: 500; color: #333;">Fijo</span>
                                            </label>
                                            
                                            <div id="slider-option" style="display: flex; align-items: center; gap: 15px; padding-left: 28px; padding-top: 10px; padding-bottom: 10px;">
                                                <input type="range" id="delay-slider" min="1" max="60" value="3" step="1" oninput="updateSliderValue()" style="flex: 1; background: linear-gradient(to right, #10b981 0%, #10b981 5%, #e5e7eb 5%, #e5e7eb 100%);">
                                                <input type="number" id="delay-slider-value" value="3" min="1" max="60" step="1" oninput="updateSliderFromInput()" style="width: 80px; padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em; text-align: center;">
                                                <span style="color: #666; font-weight: 500;">sec</span>
                                            </div>
                                        </div>
                                        
                                        <!-- Opci√≥n Aleatorio -->
                                        <div style="margin-bottom: 20px;">
                                            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; cursor: pointer;">
                                                <input type="radio" name="delay-mode" value="random" onchange="toggleDelayMode()" style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981;">
                                                <span style="font-weight: 500; color: #333;">Aleatorio</span>
                                            </label>
                                        </div>
                                        
                                        <!-- Opci√≥n Personalizado aleatorio (Recomendado) -->
                                        <div>
                                            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer;">
                                                <input type="radio" name="delay-mode" value="custom" onchange="toggleDelayMode()" style="width: 18px; height: 18px; cursor: pointer; accent-color: #10b981;">
                                                <span style="font-weight: 500; color: #333;">Personalizado aleatorio <span style="color: #ef4444; font-weight: 600;">(Recomendado)</span></span>
                                                <span style="margin-left: auto; color: #9ca3af; cursor: help;" title="Esta opci√≥n var√≠a el tiempo entre mensajes de forma aleatoria para parecer m√°s natural">‚ùì</span>
                                            </label>
                                            
                                            <div id="custom-option" style="display: none; padding-left: 28px;">
                                                <div style="display: flex; gap: 10px; align-items: center;">
                                                    <span style="color: #666; font-weight: 500;">De:</span>
                                                    <input type="number" id="delay-min" value="5" min="1" max="60" step="1" style="flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em;">
                                                    <span style="color: #666; font-weight: 500;">A:</span>
                                                    <input type="number" id="delay-max" value="15" min="1" max="60" step="1" style="flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em;">
                                                    <span style="color: #666; font-weight: 500;">segundos</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Agregar lotes -->
                                <div style="margin-bottom: 20px;">
                                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px; cursor: pointer;">
                                        <input type="checkbox" id="enable-batches" onchange="toggleBatchOptions()" style="width: 18px; height: 18px; cursor: pointer;">
                                        <span style="font-weight: 600; color: #333;">Agregar lotes <span style="color: #10b981;">(Recomendado)</span></span>
                                    </label>
                                    
                                    <div id="batch-options" style="margin-top: 10px; display: none; padding: 15px; background: #f9fafb; border-radius: 8px;">
                                        <label style="display: block; color: #666; font-size: 0.9em; margin-bottom: 10px; font-weight: 500;">Enviar en lotes de</label>
                                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                                            <input type="range" id="batch-size-slider" min="10" max="50" value="50" step="1" oninput="updateBatchSizeValue()" style="flex: 1; background: linear-gradient(to right, #10b981 0%, #10b981 100%, #e5e7eb 100%, #e5e7eb 100%);">
                                            <input type="number" id="batch-size" value="50" min="10" max="50" step="1" oninput="updateBatchSizeFromInput()" style="width: 80px; padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em; text-align: center;">
                                            <span style="color: #666; font-weight: 500;">mensajes</span>
                                        </div>
                                        
                                        <label style="display: block; color: #666; font-size: 0.9em; margin-bottom: 10px; font-weight: 500;">Agregue un intervalo de tiempo en lotes en blanco y negro de</label>
                                        <div style="display: flex; align-items: center; gap: 15px;">
                                            <input type="range" id="batch-delay-slider" min="5" max="50" value="30" step="1" oninput="updateBatchDelayValue()" style="flex: 1; background: linear-gradient(to right, #10b981 0%, #10b981 56%, #e5e7eb 56%, #e5e7eb 100%);">
                                            <input type="number" id="batch-delay" value="30" min="5" max="50" step="1" oninput="updateBatchDelayFromInput()" style="width: 80px; padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em; text-align: center;">
                                            <span style="color: #666; font-weight: 500;">segundos</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Programe su campa√±a -->
                                <div style="margin-bottom: 20px;">
                                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px; cursor: pointer;">
                                        <input type="checkbox" id="enable-schedule" onchange="toggleScheduleOptions()" style="width: 18px; height: 18px; cursor: pointer;">
                                        <span style="font-weight: 600; color: #333;">Programe su campa√±a</span>
                                    </label>
                                    
                                    <div id="schedule-options" style="margin-top: 10px; display: none; padding: 15px; background: #f9fafb; border-radius: 8px;">
                                        <label style="display: block; color: #666; font-size: 0.9em; margin-bottom: 10px; font-weight: 500;">Fecha y hora de inicio</label>
                                        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                                            <input type="date" id="schedule-date" style="flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em;">
                                            <input type="time" id="schedule-time" style="flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 1em;">
                                        </div>
                                    </div>
                                    
                                    <!-- Botones de campa√±as -->
                                    <div style="margin-top: 15px; display: flex; flex-direction: column; gap: 10px;">
                                        <div style="position: relative;">
                                            <button onclick="toggleUpcomingCampaigns()" id="upcoming-campaigns-btn" style="width: 100%; padding: 12px 20px; background: white; border: 2px solid #10b981; color: #10b981; border-radius: 8px; font-weight: 600; font-size: 1em; cursor: pointer; display: flex; align-items: center; justify-content: space-between; transition: all 0.2s;" onmouseover="this.style.background='#f0fdf4'" onmouseout="this.style.background='white'">
                                                <span>Ver campa√±as programadas</span>
                                                <span style="font-size: 0.8em;">‚ñº</span>
                                            </button>
                                            
                                            <!-- Dropdown de campa√±as programadas -->
                                            <div id="upcoming-campaigns-dropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); margin-top: 5px; z-index: 1000; max-height: 300px; overflow-y: auto;">
                                                <div style="padding: 20px; color: #9ca3af; text-align: center; font-size: 0.95em;">
                                                    No hay campa√±as programadas
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div style="position: relative;">
                                            <button onclick="togglePausedCampaigns()" id="paused-campaigns-btn" style="width: 100%; padding: 12px 20px; background: white; border: 2px solid #10b981; color: #10b981; border-radius: 8px; font-weight: 600; font-size: 1em; cursor: pointer; display: flex; align-items: center; justify-content: space-between; transition: all 0.2s;" onmouseover="this.style.background='#f0fdf4'" onmouseout="this.style.background='white'">
                                                <span>Reanudar campa√±as pausadas</span>
                                                <span style="font-size: 0.8em;">‚ñº</span>
                                            </button>
                                            
                                            <!-- Dropdown de campa√±as pausadas -->
                                            <div id="paused-campaigns-dropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); margin-top: 5px; z-index: 1000; max-height: 300px; overflow-y: auto;">
                                                <div style="padding: 20px; color: #9ca3af; text-align: center; font-size: 0.95em;">
                                                    Sin campa√±as pausadas
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                    
                </div>
                </div>

                <!-- Modal: Add Template -->
                <div id="add-template-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center;">
                    <div style="background: #e0f2f1; padding: 30px; border-radius: 15px; max-width: 600px; width: 90%; position: relative;">
                        <button onclick="closeAddTemplateModal()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 2em; cursor: pointer; color: #333;">√ó</button>
                        
                        <h2 style="margin-bottom: 20px; color: #333;">Add Template</h2>
                        
                        <div style="margin-bottom: 20px;">
                            <textarea id="template-content" placeholder="Escribe tu plantilla aqu√≠..." style="width: 100%; min-height: 200px; padding: 15px; border: 2px solid #b2dfdb; border-radius: 8px; font-size: 1em; resize: vertical; font-family: inherit;"></textarea>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                            <label style="color: #333; font-weight: bold;">Save as</label>
                            <input type="text" id="template-name" placeholder="Nombre de la plantilla" style="flex: 1; padding: 12px; border: 2px solid #b2dfdb; border-radius: 8px; font-size: 1em;">
                        </div>
                        
                        <button onclick="saveTemplate()" style="background: #26a69a; color: white; border: none; padding: 15px 40px; border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer; width: 100%;">
                            Save Template
                        </button>
                    </div>
                </div>

                <!-- Modal: Add Campaign Numbers -->
                <div id="add-campaign-numbers-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center;">
                    <div style="background: #d1e7dd; padding: 30px; border-radius: 15px; max-width: 600px; width: 90%; position: relative;">
                        <button onclick="closeAddCampaignNumbersModal()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 2em; cursor: pointer; color: #333;">√ó</button>
                        
                        <h2 style="margin-bottom: 20px; color: #333;">Save Campaign Numbers</h2>
                        
                        <div style="margin-bottom: 20px;">
                            <textarea id="campaign-numbers-content" placeholder="Escribe tu plantilla aqu√≠..." style="width: 100%; min-height: 200px; padding: 15px; border: 2px solid #b8dac6; border-radius: 8px; font-size: 1em; resize: vertical; font-family: inherit; background: white;"></textarea>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                            <label style="color: #333; font-weight: bold;">Nombre de la campa√±a</label>
                            <input type="text" id="campaign-numbers-name" placeholder="Nombre de la campa√±a" style="flex: 1; padding: 12px; border: 2px solid #b8dac6; border-radius: 8px; font-size: 1em; background: white;">
                        </div>
                        
                        <button onclick="saveCampaignNumbers()" style="background: #26a69a; color: white; border: none; padding: 15px 40px; border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer; width: 100%;">
                            Save Campaign Numbers
                        </button>
                    </div>
                </div>

                <!-- Secci√≥n para Groups -->
                <div id="section-groups">
                    <div class="form-group">
                        <label>Filtrar por Pa√≠s</label>
                        <select id="country-select" onchange="loadGroups()">
                            <option value="USA">üá∫üá∏ USA</option>
                            <option value="COLOMBIA">üá®üá¥ Colombia</option>
                            <option value="VENEZUELA">üáªüá™ Venezuela</option>
                            <option value="ARGENTINA">üá¶üá∑ Argentina</option>
                            <option value="MEXICO">üá≤üáΩ M√©xico</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="select-all" onchange="toggleSelectAll()">
                            Seleccionar Todos (<span id="group-count">0</span> grupos)
                        </label>
                        <div style="margin-bottom: 10px;">
                            <input type="text" id="search-groups" placeholder="üîç Buscar grupos por nombre..." style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px;" oninput="filterGroups()">
                        </div>
                        <div id="groups-list" style="max-height: 200px; overflow-y: auto; border: 2px solid #e5e7eb; border-radius: 8px; padding: 10px;">
                            <p style="color: #666;">Cargando grupos...</p>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n para Contacts -->
                <div id="section-contacts" style="display: none;">
                    <div class="form-group">
                        <label>Seleccionar contactos para enviar mensaje</label>
                        <p style="color: #666; font-size: 0.9em; margin-bottom: 10px;">
                            Seleccione contactos desde el dropdown...
                        </p>
                        <select id="contacts-select" multiple style="min-height: 150px;">
                            <option value="">Cargando contactos...</option>
                        </select>
                    </div>
                    <div style="margin-top: 10px;">
                        <input type="text" id="search-contacts" placeholder="üîç Buscar contactos por nombre..." style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px;" oninput="filterContacts()">
                    </div>
                    <div style="margin-top: 10px;">
                        <label>
                            <input type="checkbox" id="select-all-contacts" onchange="toggleSelectAllContacts()">
                            Seleccionar Todos
                        </label>
                    </div>
                </div>


            </div>

            <!-- Tab Content: Templates -->
            <div id="tab-templates" class="tab-content">
                <h2>üìã Templates de Mensajes</h2>
                <p style="color: #666; margin-bottom: 20px;">Guarda y reutiliza tus mensajes m√°s frecuentes</p>
                
                <button class="btn-secondary" onclick="showNewTemplateModal()" style="margin-bottom: 20px;">
                    ‚ûï Nuevo Template
                </button>

                <div class="template-list" id="templates-list" style="max-height: 500px;">
                    <p style="color: #666;">Cargando templates...</p>
                </div>
            </div>

            <!-- Tab Content: Campa√±as Programadas -->
            <div id="tab-campaigns" class="tab-content">
                <h2>üìÖ Campa√±as Programadas</h2>
                <p style="color: #666; margin-bottom: 20px;">Programa tus env√≠os para fecha y hora espec√≠fica</p>

                <div style="margin-bottom: 20px;">
                    <button class="btn-primary" onclick="showScheduleCampaignModal()">
                        ‚ûï Programar Nueva Campa√±a
                    </button>
                </div>

                <h3 style="margin-top: 30px; margin-bottom: 15px;">Pr√≥ximas Campa√±as</h3>
                <div id="scheduled-campaigns-list" style="border: 2px solid #e5e7eb; border-radius: 8px; padding: 15px; min-height: 200px;">
                    <p style="color: #666;">No hay campa√±as programadas</p>
                </div>

                <h3 style="margin-top: 30px; margin-bottom: 15px;">Campa√±as Pausadas</h3>
                <div id="paused-campaigns-list" style="border: 2px solid #e5e7eb; border-radius: 8px; padding: 15px; min-height: 200px;">
                    <p style="color: #666;">No hay campa√±as pausadas</p>
                </div>
            </div>

            <!-- Tab Content: Estad√≠sticas -->
            <div id="tab-stats" class="tab-content">
                <h2>üìä Estad√≠sticas de Env√≠os</h2>
                <p style="color: #666; margin-bottom: 20px;">Monitorea el rendimiento de tus campa√±as</p>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold;" id="stat-total">0</div>
                        <div style="font-size: 1.1em;">Total Grupos</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold;" id="stat-sent">0</div>
                        <div style="font-size: 1.1em;">Enviados</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold;" id="stat-failed">0</div>
                        <div style="font-size: 1.1em;">Fallidos</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold;" id="stat-progress">0%</div>
                        <div style="font-size: 1.1em;">Progreso</div>
                    </div>
                </div>

                <h3 style="margin-bottom: 15px;">Historial de Campa√±as</h3>
                <div id="campaigns-history" style="border: 2px solid #e5e7eb; border-radius: 8px; padding: 15px; min-height: 300px;">
                    <p style="color: #666;">No hay historial de campa√±as</p>
                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let selectedGroups = [];
        let allGroups = [];
        let phone = '';
        let campaignRunning = false;

        window.onload = () => {
            const urlParams = new URLSearchParams(window.location.search);
            phone = urlParams.get('phone');
            
            if (!phone) {
                alert('N√∫mero de tel√©fono no especificado');
                window.location.href = '/';
                return;
            }

            loadGroups();
            loadTemplates();
            loadScheduledCampaigns();
            setupSocketListeners();
        };

        function switchTab(tabName) {
            // Ocultar todos los tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Mostrar el tab seleccionado
            document.getElementById('tab-' + tabName).classList.add('active');
            event.target.classList.add('active');

            // Cargar datos seg√∫n el tab
            if (tabName === 'templates') {
                loadTemplates();
            } else if (tabName === 'campaigns') {
                loadScheduledCampaigns();
            } else if (tabName === 'stats') {
                loadStatistics();
            }
        }

        function changeSendMode(mode) {
            // Ocultar todas las secciones
            document.getElementById('section-numbers').style.display = 'none';
            document.getElementById('section-groups').style.display = 'none';
            document.getElementById('section-contacts').style.display = 'none';

            // Mostrar la secci√≥n seleccionada
            document.getElementById('section-' + mode).style.display = 'block';

            // Cargar datos seg√∫n el modo
            if (mode === 'groups') {
                loadGroups();
            } else if (mode === 'contacts') {
                loadContacts();
            }
        }

        function filterGroups() {
            const searchTerm = document.getElementById('search-groups').value.toLowerCase();
            const filteredGroups = allGroups.filter(group => 
                (group.name || '').toLowerCase().includes(searchTerm)
            );
            displayGroups(filteredGroups);
        }

        function showExampleNumbers() {
            // Descargar template de Excel
            downloadExcelTemplate();
        }

        function downloadExcelTemplate() {
            // Crear datos de ejemplo para el template
            const data = [
                ['Phone Number'],
                ['5062345678'],
                ['5062876543'],
                ['5063456789'],
                ['5064567890']
            ];
            
            // Convertir a CSV (compatible con Excel)
            const csvContent = data.map(row => row.join(',')).join('\n');
            
            // Crear blob y descargar
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', 'template_numbers.csv');
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showStatus('success', '‚úÖ Template descargado exitosamente');
        }

        function uploadNumbersFile() {
            alert('Funcionalidad de subir Excel en desarrollo');
        }

        function formatText(type) {
            const textarea = document.getElementById('message-numbers');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            if (!selectedText) {
                alert('Por favor selecciona el texto que deseas formatear');
                return;
            }
            
            let formattedText = '';
            switch(type) {
                case 'bold':
                    formattedText = `*${selectedText}*`;
                    break;
                case 'italic':
                    formattedText = `_${selectedText}_`;
                    break;
                case 'strike':
                    formattedText = `~${selectedText}~`;
                    break;
                case 'code':
                    formattedText = `\`${selectedText}\``;
                    break;
            }
            
            textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
            textarea.focus();
            textarea.setSelectionRange(start, start + formattedText.length);
        }

        function attachFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*,video/*,application/pdf,.doc,.docx';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    alert(`Archivo seleccionado: ${file.name}\n(Funcionalidad de env√≠o en desarrollo)`);
                }
            };
            input.click();
        }

        function toggleTemplateMenu() {
            const dropdown = document.getElementById('template-dropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        // Cerrar el men√∫ si se hace clic fuera de √©l
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('template-dropdown');
            const btn = document.getElementById('template-btn');
            
            if (dropdown && btn && !dropdown.contains(event.target) && !btn.contains(event.target)) {
                dropdown.style.display = 'none';
            }
        });

        function showAddTemplateModal() {
            document.getElementById('add-template-modal').style.display = 'flex';
            document.getElementById('template-dropdown').style.display = 'none';
        }

        function closeAddTemplateModal() {
            document.getElementById('add-template-modal').style.display = 'none';
            document.getElementById('template-content').value = '';
            document.getElementById('template-name').value = '';
        }

        function saveTemplate() {
            const content = document.getElementById('template-content').value.trim();
            const name = document.getElementById('template-name').value.trim();
            
            if (!content) {
                alert('Por favor escribe el contenido de la plantilla');
                return;
            }
            
            if (!name) {
                alert('Por favor escribe un nombre para la plantilla');
                return;
            }
            
            fetch('/api/templates', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    name: name, 
                    message: content, 
                    category: 'general' 
                })
            })
            .then(res => res.json())
            .then(result => {
                if (result.success) {
                    alert('‚úÖ Template guardado exitosamente');
                    closeAddTemplateModal();
                    loadTemplates();
                } else {
                    alert('‚ùå Error: ' + result.error);
                }
            })
            .catch(error => {
                alert('‚ùå Error al guardar template: ' + error.message);
            });
        }

        // Lista completa de pa√≠ses con c√≥digos ISO
        const countries = [
            { name: 'Canada', code: '+1', iso: 'CA', native: 'Canada' },
            { name: 'United States', code: '+1', iso: 'US', native: 'United States' },
            { name: 'Afghanistan', code: '+93', iso: 'AF', native: 'ÿßŸÅÿ∫ÿßŸÜÿ≥ÿ™ÿßŸÜ' },
            { name: 'Albania', code: '+355', iso: 'AL', native: 'Shqip√´ri' },
            { name: 'Algeria', code: '+213', iso: 'DZ', native: 'ÿßŸÑÿ¨ÿ≤ÿßÿ¶ÿ±' },
            { name: 'American Samoa', code: '+1', iso: 'AS', native: 'American Samoa' },
            { name: 'Andorra', code: '+376', iso: 'AD', native: 'Andorra' },
            { name: 'Angola', code: '+244', iso: 'AO', native: 'Angola' },
            { name: 'Argentina', code: '+54', iso: 'AR', native: 'Argentina' },
            { name: 'Armenia', code: '+374', iso: 'AM', native: '’Ä’°’µ’°’Ω’ø’°’∂' },
            { name: 'Australia', code: '+61', iso: 'AU', native: 'Australia' },
            { name: 'Austria', code: '+43', iso: 'AT', native: '√ñsterreich' },
            { name: 'Azerbaijan', code: '+994', iso: 'AZ', native: 'Az…ôrbaycan' },
            { name: 'Bahamas', code: '+1242', iso: 'BS', native: 'Bahamas' },
            { name: 'Bahrain', code: '+973', iso: 'BH', native: 'ÿßŸÑÿ®ÿ≠ÿ±ŸäŸÜ' },
            { name: 'Bangladesh', code: '+880', iso: 'BD', native: '‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂' },
            { name: 'Barbados', code: '+1246', iso: 'BB', native: 'Barbados' },
            { name: 'Belarus', code: '+375', iso: 'BY', native: '–ë–µ–ª–∞—Ä—É—Å—å' },
            { name: 'Belgium', code: '+32', iso: 'BE', native: 'Belgi√´' },
            { name: 'Belize', code: '+501', iso: 'BZ', native: 'Belize' },
            { name: 'Benin', code: '+229', iso: 'BJ', native: 'B√©nin' },
            { name: 'Bolivia', code: '+591', iso: 'BO', native: 'Bolivia' },
            { name: 'Bosnia', code: '+387', iso: 'BA', native: 'Bosna i Hercegovina' },
            { name: 'Botswana', code: '+267', iso: 'BW', native: 'Botswana' },
            { name: 'Brazil', code: '+55', iso: 'BR', native: 'Brasil' },
            { name: 'Bulgaria', code: '+359', iso: 'BG', native: '–ë—ä–ª–≥–∞—Ä–∏—è' },
            { name: 'Cambodia', code: '+855', iso: 'KH', native: '·ûÄ·ûò·üí·ûñ·ûª·ûá·û∂' },
            { name: 'Cameroon', code: '+237', iso: 'CM', native: 'Cameroun' },
            { name: 'Chile', code: '+56', iso: 'CL', native: 'Chile' },
            { name: 'China', code: '+86', iso: 'CN', native: '‰∏≠ÂõΩ' },
            { name: 'Colombia', code: '+57', iso: 'CO', native: 'Colombia' },
            { name: 'Costa Rica', code: '+506', iso: 'CR', native: 'Costa Rica' },
            { name: 'Croatia', code: '+385', iso: 'HR', native: 'Hrvatska' },
            { name: 'Cuba', code: '+53', iso: 'CU', native: 'Cuba' },
            { name: 'Cyprus', code: '+357', iso: 'CY', native: 'ŒöœçœÄœÅŒøœÇ' },
            { name: 'Czech Republic', code: '+420', iso: 'CZ', native: 'ƒåesk√° republika' },
            { name: 'Denmark', code: '+45', iso: 'DK', native: 'Danmark' },
            { name: 'Dominican Republic', code: '+1809', iso: 'DO', native: 'Rep√∫blica Dominicana' },
            { name: 'Ecuador', code: '+593', iso: 'EC', native: 'Ecuador' },
            { name: 'Egypt', code: '+20', iso: 'EG', native: 'ŸÖÿµÿ±' },
            { name: 'El Salvador', code: '+503', iso: 'SV', native: 'El Salvador' },
            { name: 'Estonia', code: '+372', iso: 'EE', native: 'Eesti' },
            { name: 'Ethiopia', code: '+251', iso: 'ET', native: '·ä¢·âµ·ãÆ·åµ·ã´' },
            { name: 'Finland', code: '+358', iso: 'FI', native: 'Suomi' },
            { name: 'France', code: '+33', iso: 'FR', native: 'France' },
            { name: 'Germany', code: '+49', iso: 'DE', native: 'Deutschland' },
            { name: 'Ghana', code: '+233', iso: 'GH', native: 'Ghana' },
            { name: 'Greece', code: '+30', iso: 'GR', native: 'ŒïŒªŒªŒ¨Œ¥Œ±' },
            { name: 'Guatemala', code: '+502', iso: 'GT', native: 'Guatemala' },
            { name: 'Haiti', code: '+509', iso: 'HT', native: 'Ha√Øti' },
            { name: 'Honduras', code: '+504', iso: 'HN', native: 'Honduras' },
            { name: 'Hong Kong', code: '+852', iso: 'HK', native: 'È¶ôÊ∏Ø' },
            { name: 'Hungary', code: '+36', iso: 'HU', native: 'Magyarorsz√°g' },
            { name: 'Iceland', code: '+354', iso: 'IS', native: '√çsland' },
            { name: 'India', code: '+91', iso: 'IN', native: '‡§≠‡§æ‡§∞‡§§' },
            { name: 'Indonesia', code: '+62', iso: 'ID', native: 'Indonesia' },
            { name: 'Iran', code: '+98', iso: 'IR', native: 'ÿß€åÿ±ÿßŸÜ' },
            { name: 'Iraq', code: '+964', iso: 'IQ', native: 'ÿßŸÑÿπÿ±ÿßŸÇ' },
            { name: 'Ireland', code: '+353', iso: 'IE', native: '√âire' },
            { name: 'Israel', code: '+972', iso: 'IL', native: '◊ô◊©◊®◊ê◊ú' },
            { name: 'Italy', code: '+39', iso: 'IT', native: 'Italia' },
            { name: 'Jamaica', code: '+1876', iso: 'JM', native: 'Jamaica' },
            { name: 'Japan', code: '+81', iso: 'JP', native: 'Êó•Êú¨' },
            { name: 'Jordan', code: '+962', iso: 'JO', native: 'ÿßŸÑÿ£ÿ±ÿØŸÜ' },
            { name: 'Kazakhstan', code: '+7', iso: 'KZ', native: '“ö–∞–∑–∞“õ—Å—Ç–∞–Ω' },
            { name: 'Kenya', code: '+254', iso: 'KE', native: 'Kenya' },
            { name: 'Kuwait', code: '+965', iso: 'KW', native: 'ÿßŸÑŸÉŸàŸäÿ™' },
            { name: 'Latvia', code: '+371', iso: 'LV', native: 'Latvija' },
            { name: 'Lebanon', code: '+961', iso: 'LB', native: 'ŸÑÿ®ŸÜÿßŸÜ' },
            { name: 'Libya', code: '+218', iso: 'LY', native: 'ŸÑŸäÿ®Ÿäÿß' },
            { name: 'Lithuania', code: '+370', iso: 'LT', native: 'Lietuva' },
            { name: 'Luxembourg', code: '+352', iso: 'LU', native: 'Luxembourg' },
            { name: 'Malaysia', code: '+60', iso: 'MY', native: 'Malaysia' },
            { name: 'Mexico', code: '+52', iso: 'MX', native: 'M√©xico' },
            { name: 'Morocco', code: '+212', iso: 'MA', native: 'ÿßŸÑŸÖÿ∫ÿ±ÿ®' },
            { name: 'Netherlands', code: '+31', iso: 'NL', native: 'Nederland' },
            { name: 'New Zealand', code: '+64', iso: 'NZ', native: 'New Zealand' },
            { name: 'Nicaragua', code: '+505', iso: 'NI', native: 'Nicaragua' },
            { name: 'Nigeria', code: '+234', iso: 'NG', native: 'Nigeria' },
            { name: 'Norway', code: '+47', iso: 'NO', native: 'Norge' },
            { name: 'Pakistan', code: '+92', iso: 'PK', native: 'Ÿæÿß⁄©ÿ≥ÿ™ÿßŸÜ' },
            { name: 'Panama', code: '+507', iso: 'PA', native: 'Panam√°' },
            { name: 'Paraguay', code: '+595', iso: 'PY', native: 'Paraguay' },
            { name: 'Peru', code: '+51', iso: 'PE', native: 'Per√∫' },
            { name: 'Philippines', code: '+63', iso: 'PH', native: 'Philippines' },
            { name: 'Poland', code: '+48', iso: 'PL', native: 'Polska' },
            { name: 'Portugal', code: '+351', iso: 'PT', native: 'Portugal' },
            { name: 'Puerto Rico', code: '+1787', iso: 'PR', native: 'Puerto Rico' },
            { name: 'Qatar', code: '+974', iso: 'QA', native: 'ŸÇÿ∑ÿ±' },
            { name: 'Romania', code: '+40', iso: 'RO', native: 'Rom√¢nia' },
            { name: 'Russia', code: '+7', iso: 'RU', native: '–†–æ—Å—Å–∏—è' },
            { name: 'Saudi Arabia', code: '+966', iso: 'SA', native: 'ÿßŸÑÿ≥ÿπŸàÿØŸäÿ©' },
            { name: 'Serbia', code: '+381', iso: 'RS', native: '–°—Ä–±–∏—ò–∞' },
            { name: 'Singapore', code: '+65', iso: 'SG', native: 'Singapore' },
            { name: 'Slovakia', code: '+421', iso: 'SK', native: 'Slovensko' },
            { name: 'Slovenia', code: '+386', iso: 'SI', native: 'Slovenija' },
            { name: 'South Africa', code: '+27', iso: 'ZA', native: 'South Africa' },
            { name: 'South Korea', code: '+82', iso: 'KR', native: 'ÎåÄÌïúÎØºÍµ≠' },
            { name: 'Spain', code: '+34', iso: 'ES', native: 'Espa√±a' },
            { name: 'Sri Lanka', code: '+94', iso: 'LK', native: '‡∑Å‡∑ä‚Äç‡∂ª‡∑ì ‡∂Ω‡∂Ç‡∂ö‡∑è' },
            { name: 'Sweden', code: '+46', iso: 'SE', native: 'Sverige' },
            { name: 'Switzerland', code: '+41', iso: 'CH', native: 'Schweiz' },
            { name: 'Syria', code: '+963', iso: 'SY', native: 'ÿ≥Ÿàÿ±Ÿäÿß' },
            { name: 'Taiwan', code: '+886', iso: 'TW', native: 'Âè∞ÁÅ£' },
            { name: 'Thailand', code: '+66', iso: 'TH', native: '‡πÑ‡∏ó‡∏¢' },
            { name: 'Tunisia', code: '+216', iso: 'TN', native: 'ÿ™ŸàŸÜÿ≥' },
            { name: 'Turkey', code: '+90', iso: 'TR', native: 'T√ºrkiye' },
            { name: 'Ukraine', code: '+380', iso: 'UA', native: '–£–∫—Ä–∞—ó–Ω–∞' },
            { name: 'United Arab Emirates', code: '+971', iso: 'AE', native: 'ÿßŸÑÿ•ŸÖÿßÿ±ÿßÿ™' },
            { name: 'United Kingdom', code: '+44', iso: 'GB', native: 'United Kingdom' },
            { name: 'Uruguay', code: '+598', iso: 'UY', native: 'Uruguay' },
            { name: 'Venezuela', code: '+58', iso: 'VE', native: 'Venezuela' },
            { name: 'Vietnam', code: '+84', iso: 'VN', native: 'Vi·ªát Nam' },
            { name: 'Yemen', code: '+967', iso: 'YE', native: 'ÿßŸÑŸäŸÖŸÜ' }
        ];

        let allCountries = countries;
        let selectedCountryCode = '+1';

        // Inicializar lista de pa√≠ses
        function initCountriesList() {
            displayCountries(allCountries);
        }

        function displayCountries(countriesToShow) {
            const container = document.getElementById('countries-list');
            
            container.innerHTML = countriesToShow.map(country => {
                const safeName = country.name.replace(/'/g, "\\'");
                const flagUrl = `https://flagcdn.com/w40/${country.iso.toLowerCase()}.png`;
                
                return `
                <div onclick="selectCountry('${country.code}', '${country.iso}', '${safeName}')" style="padding: 12px; cursor: pointer; display: flex; align-items: center; gap: 12px; border-bottom: 1px solid #f3f4f6; transition: background 0.2s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='white'">
                    <img src="${flagUrl}" alt="${country.iso}" style="width: 32px; height: 24px; border-radius: 3px; object-fit: cover; box-shadow: 0 1px 3px rgba(0,0,0,0.1);" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div style="display: none; width: 32px; height: 24px; background: #f3f4f6; border-radius: 3px; align-items: center; justify-content: center; font-weight: bold; font-size: 0.7em; color: #666;">
                        ${country.iso}
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 500; color: #333;">${country.name}</div>
                        <div style="font-size: 0.85em; color: #999;">${country.native}</div>
                    </div>
                    <span style="color: #10b981; font-weight: bold;">${country.code}</span>
                </div>
                `;
            }).join('');
        }

        function toggleCountryDropdown() {
            const dropdown = document.getElementById('country-dropdown');
            const isVisible = dropdown.style.display === 'block';
            dropdown.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                document.getElementById('country-search').value = '';
                displayCountries(allCountries);
            }
        }

        function selectCountry(code, iso, name) {
            selectedCountryCode = code;
            const flagImg = document.getElementById('selected-flag-img');
            flagImg.src = `https://flagcdn.com/w40/${iso.toLowerCase()}.png`;
            flagImg.alt = iso;
            document.getElementById('selected-code').textContent = code;
            document.getElementById('country-dropdown').style.display = 'none';
        }

        function filterCountries() {
            const searchTerm = document.getElementById('country-search').value.toLowerCase();
            const filtered = allCountries.filter(country => 
                country.name.toLowerCase().includes(searchTerm) ||
                country.native.toLowerCase().includes(searchTerm) ||
                country.code.includes(searchTerm)
            );
            displayCountries(filtered);
        }

        // Cerrar dropdown al hacer clic fuera
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('country-dropdown');
            const btn = document.getElementById('country-selector-btn');
            
            if (dropdown && btn && !dropdown.contains(event.target) && !btn.contains(event.target)) {
                dropdown.style.display = 'none';
            }
        });

        // Inicializar cuando cargue la p√°gina
        window.addEventListener('load', function() {
            initCountriesList();
            
            // Prevenir que el scroll del mouse cambie los valores de inputs num√©ricos
            document.querySelectorAll('input[type="number"]').forEach(input => {
                input.addEventListener('wheel', function(e) {
                    e.preventDefault();
                }, { passive: false });
            });
        });

        async function loadContacts() {
            // Simular carga de contactos
            const contactsSelect = document.getElementById('contacts-select');
            contactsSelect.innerHTML = `
                <option value="contact1">Juan P√©rez - +1234567890</option>
                <option value="contact2">Mar√≠a Garc√≠a - +0987654321</option>
                <option value="contact3">Carlos L√≥pez - +1122334455</option>
            `;
        }

        function filterContacts() {
            const searchTerm = document.getElementById('search-contacts').value.toLowerCase();
            const options = document.querySelectorAll('#contacts-select option');
            
            options.forEach(option => {
                const text = option.textContent.toLowerCase();
                option.style.display = text.includes(searchTerm) ? 'block' : 'none';
            });
        }

        function toggleSelectAllContacts() {
            const selectAll = document.getElementById('select-all-contacts').checked;
            const options = document.querySelectorAll('#contacts-select option');
            
            options.forEach(option => {
                option.selected = selectAll;
            });
        }

        function setupSocketListeners() {
            socket.on('campaign-completed', (data) => {
                if (data.phone === phone) {
                    showStatus('success', `‚úÖ Campa√±a completada! Enviados: ${data.results.sent}, Fallidos: ${data.results.failed}`);
                    campaignRunning = false;
                    document.getElementById('campaign-controls').style.display = 'none';
                }
            });

            socket.on('campaign-error', (data) => {
                if (data.phone === phone) {
                    showStatus('error', `‚ùå Error en campa√±a: ${data.error}`);
                    campaignRunning = false;
                    document.getElementById('campaign-controls').style.display = 'none';
                }
            });
        }

        async function loadGroups() {
            const country = document.getElementById('country-select').value;
            
            try {
                const response = await fetch(`/api/groups/successful?country=${country}`);
                const groups = await response.json();
                
                allGroups = groups;
                displayGroups(groups);
            } catch (error) {
                console.error('Error cargando grupos:', error);
            }
        }

        function displayGroups(groups) {
            const container = document.getElementById('groups-list');
            document.getElementById('group-count').textContent = groups.length;
            
            if (groups.length === 0) {
                container.innerHTML = '<p style="color: #666;">No hay grupos disponibles</p>';
                return;
            }

            container.innerHTML = groups.map(group => `
                <div style="padding: 8px; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; justify-content: space-between;">
                    <label style="flex: 1; cursor: pointer; text-align: left;" onclick="event.target.nextElementSibling.click()">
                        ${group.name || 'Grupo sin nombre'}
                    </label>
                    <input type="checkbox" class="group-checkbox" value="${group.group_id}" onchange="updateSelectedGroups()" style="margin: 0;">
                </div>
            `).join('');
        }

        function toggleSelectAll() {
            const selectAll = document.getElementById('select-all').checked;
            const checkboxes = document.querySelectorAll('.group-checkbox');
            
            checkboxes.forEach(cb => {
                cb.checked = selectAll;
            });
            
            updateSelectedGroups();
        }

        function updateSelectedGroups() {
            const checkboxes = document.querySelectorAll('.group-checkbox:checked');
            selectedGroups = Array.from(checkboxes).map(cb => cb.value);
            console.log('Grupos seleccionados:', selectedGroups.length);
        }

        async function loadTemplates() {
            try {
                const response = await fetch('/api/templates');
                const data = await response.json();
                
                if (data.success) {
                    displayTemplates(data.templates);
                }
            } catch (error) {
                console.error('Error cargando templates:', error);
            }
        }

        function displayTemplates(templates) {
            const container = document.getElementById('templates-list');
            
            if (templates.length === 0) {
                container.innerHTML = '<p style="color: #666;">No hay templates</p>';
                return;
            }

            container.innerHTML = templates.map(template => `
                <div class="template-item" onclick="useTemplate(${template.id})">
                    <div class="template-name">${template.name}</div>
                    <div class="template-preview">${template.message}</div>
                </div>
            `).join('');
        }

        function useTemplate(templateId) {
            fetch(`/api/templates`)
                .then(res => res.json())
                .then(data => {
                    const template = data.templates.find(t => t.id === templateId);
                    if (template) {
                        document.getElementById('message').value = template.message;
                    }
                });
        }

        async function sendCampaign() {
            if (selectedGroups.length === 0) {
                showStatus('error', 'Por favor selecciona al menos un grupo');
                return;
            }

            const message = document.getElementById('message').value.trim();
            if (!message) {
                showStatus('error', 'Por favor escribe un mensaje');
                return;
            }

            const config = {
                delays: {
                    min: parseInt(document.getElementById('delay-min').value),
                    max: parseInt(document.getElementById('delay-max').value)
                },
                batchSize: parseInt(document.getElementById('batch-size').value),
                batchDelay: parseInt(document.getElementById('batch-delay').value),
                pauseEvery: parseInt(document.getElementById('pause-every').value),
                pauseDuration: parseInt(document.getElementById('pause-duration').value)
            };

            try {
                showStatus('info', 'üöÄ Iniciando campa√±a...');
                campaignRunning = true;
                document.getElementById('campaign-controls').style.display = 'flex';

                const response = await fetch('/api/campaigns/send', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        phone,
                        groupIds: selectedGroups,
                        message,
                        config
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    showStatus('info', 'üì§ Campa√±a en progreso...');
                } else {
                    showStatus('error', result.message);
                    campaignRunning = false;
                    document.getElementById('campaign-controls').style.display = 'none';
                }
            } catch (error) {
                showStatus('error', 'Error: ' + error.message);
                campaignRunning = false;
                document.getElementById('campaign-controls').style.display = 'none';
            }
        }

        function pauseCampaign() {
            showStatus('info', '‚è∏Ô∏è Pausando campa√±a...');
            // Implementar l√≥gica de pausa
        }

        function stopCampaign() {
            if (confirm('¬øEst√°s seguro de que quieres detener la campa√±a?')) {
                showStatus('info', 'üõë Deteniendo campa√±a...');
                campaignRunning = false;
                document.getElementById('campaign-controls').style.display = 'none';
            }
        }

        function showStatus(type, message) {
            const statusDiv = document.getElementById('status-message');
            statusDiv.className = 'status-message ' + type;
            statusDiv.textContent = message;
        }

        function goBack() {
            window.location.href = `/dashboard?phone=${encodeURIComponent(phone)}`;
        }

        function showNewTemplateModal() {
            const name = prompt('Nombre del template:');
            if (!name) return;

            const message = prompt('Mensaje del template:');
            if (!message) return;

            const category = prompt('Categor√≠a (opcional):', 'general');

            fetch('/api/templates', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, message, category: category || 'general' })
            })
            .then(res => res.json())
            .then(result => {
                if (result.success) {
                    alert('Template creado exitosamente');
                    loadTemplates();
                } else {
                    alert('Error: ' + result.error);
                }
            });
        }

        async function loadScheduledCampaigns() {
            try {
                const response = await fetch(`/api/campaigns/scheduled?phone=${phone}`);
                const data = await response.json();
                
                if (data.success && data.campaigns.length > 0) {
                    displayScheduledCampaigns(data.campaigns);
                }

                const pausedResponse = await fetch(`/api/campaigns/paused?phone=${phone}`);
                const pausedData = await pausedResponse.json();
                
                if (pausedData.success && pausedData.campaigns.length > 0) {
                    displayPausedCampaigns(pausedData.campaigns);
                }
            } catch (error) {
                console.error('Error cargando campa√±as:', error);
            }
        }

        function displayScheduledCampaigns(campaigns) {
            const container = document.getElementById('scheduled-campaigns-list');
            container.innerHTML = campaigns.map(campaign => `
                <div style="padding: 15px; border-bottom: 1px solid #e5e7eb; background: #f9fafb; margin-bottom: 10px; border-radius: 8px;">
                    <div style="font-weight: bold; margin-bottom: 5px;">${campaign.name}</div>
                    <div style="color: #666; font-size: 0.9em;">
                        üìÖ ${new Date(campaign.scheduled_at).toLocaleString()}
                    </div>
                    <div style="color: #666; font-size: 0.9em;">
                        üìä ${JSON.parse(campaign.group_ids).length} grupos
                    </div>
                    <button onclick="deleteCampaign(${campaign.id})" style="margin-top: 10px; padding: 5px 15px; background: #ef4444; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        üóëÔ∏è Eliminar
                    </button>
                </div>
            `).join('');
        }

        function displayPausedCampaigns(campaigns) {
            const container = document.getElementById('paused-campaigns-list');
            container.innerHTML = campaigns.map(campaign => `
                <div style="padding: 15px; border-bottom: 1px solid #e5e7eb; background: #fef3c7; margin-bottom: 10px; border-radius: 8px;">
                    <div style="font-weight: bold; margin-bottom: 5px;">${campaign.name}</div>
                    <div style="color: #666; font-size: 0.9em;">
                        üìä ${JSON.parse(campaign.group_ids).length} grupos
                    </div>
                    <div style="margin-top: 10px; display: flex; gap: 10px;">
                        <button onclick="resumeCampaign(${campaign.id})" style="padding: 5px 15px; background: #10b981; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            ‚ñ∂Ô∏è Reanudar
                        </button>
                        <button onclick="deleteCampaign(${campaign.id})" style="padding: 5px 15px; background: #ef4444; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            üóëÔ∏è Eliminar
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function showScheduleCampaignModal() {
            alert('Funcionalidad de programaci√≥n en desarrollo');
        }

        async function deleteCampaign(id) {
            if (!confirm('¬øEliminar esta campa√±a?')) return;

            try {
                const response = await fetch(`/api/campaigns/${id}`, { method: 'DELETE' });
                const result = await response.json();
                
                if (result.success) {
                    alert('Campa√±a eliminada');
                    loadScheduledCampaigns();
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function resumeCampaign(id) {
            try {
                const response = await fetch(`/api/campaigns/${id}/resume`, { method: 'POST' });
                const result = await response.json();
                
                if (result.success) {
                    alert('Campa√±a reanudada');
                    loadScheduledCampaigns();
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        function loadStatistics() {
            // Cargar estad√≠sticas desde el servidor
            console.log('Cargando estad√≠sticas...');
        }

        // Funciones para Campaign Numbers
        function toggleCampaignNumbersMenu() {
            const dropdown = document.getElementById('campaign-numbers-dropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        function showAddCampaignNumberModal() {
            document.getElementById('campaign-numbers-dropdown').style.display = 'none';
            document.getElementById('add-campaign-numbers-modal').style.display = 'flex';
        }

        function closeAddCampaignNumbersModal() {
            document.getElementById('add-campaign-numbers-modal').style.display = 'none';
            document.getElementById('campaign-numbers-content').value = '';
            document.getElementById('campaign-numbers-name').value = '';
        }

        function saveCampaignNumbers() {
            const content = document.getElementById('campaign-numbers-content').value.trim();
            const name = document.getElementById('campaign-numbers-name').value.trim();
            
            if (!content) {
                alert('Por favor escribe el contenido de la plantilla');
                return;
            }
            
            if (!name) {
                alert('Por favor escribe un nombre para la plantilla');
                return;
            }
            
            // Aqu√≠ puedes agregar la l√≥gica para guardar en el servidor
            fetch('/api/campaign-numbers', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    name: name, 
                    content: content,
                    phone: phone
                })
            })
            .then(res => res.json())
            .then(result => {
                if (result.success) {
                    alert('‚úÖ Campaign Numbers guardado exitosamente');
                    closeAddCampaignNumbersModal();
                    // Recargar la lista de campaign numbers
                    loadCampaignNumbers();
                } else {
                    alert('‚ùå Error: ' + result.error);
                }
            })
            .catch(error => {
                alert('‚ùå Error al guardar: ' + error.message);
            });
        }

        function loadCampaignNumbers() {
            // Funci√≥n para cargar la lista de campaign numbers guardados
            // Se puede implementar cuando tengas el endpoint del servidor
            console.log('Cargando campaign numbers...');
        }

        // Cerrar el men√∫ de Campaign Numbers si se hace clic fuera de √©l
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('campaign-numbers-dropdown');
            const btn = document.getElementById('campaign-numbers-btn');
            
            if (dropdown && btn && !dropdown.contains(event.target) && !btn.contains(event.target)) {
                dropdown.style.display = 'none';
            }
        });

        // Funciones para mostrar/ocultar opciones avanzadas
        function toggleDelayOptions() {
            const checkbox = document.getElementById('enable-delays');
            const options = document.getElementById('delay-options');
            options.style.display = checkbox.checked ? 'block' : 'none';
        }

        function toggleBatchOptions() {
            const checkbox = document.getElementById('enable-batches');
            const options = document.getElementById('batch-options');
            options.style.display = checkbox.checked ? 'block' : 'none';
        }

        function toggleScheduleOptions() {
            const checkbox = document.getElementById('enable-schedule');
            const options = document.getElementById('schedule-options');
            
            if (checkbox.checked) {
                options.style.display = 'block';
                
                // Obtener fecha y hora actual
                const now = new Date();
                
                // Formatear fecha (YYYY-MM-DD)
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const dateString = `${year}-${month}-${day}`;
                
                // Formatear hora (HH:MM)
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const timeString = `${hours}:${minutes}`;
                
                // Establecer valores en los inputs
                document.getElementById('schedule-date').value = dateString;
                document.getElementById('schedule-time').value = timeString;
            } else {
                options.style.display = 'none';
            }
        }

        function toggleUpcomingCampaigns() {
            const dropdown = document.getElementById('upcoming-campaigns-dropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        function togglePausedCampaigns() {
            const dropdown = document.getElementById('paused-campaigns-dropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        // Cerrar los dropdowns de campa√±as al hacer clic fuera
        document.addEventListener('click', function(event) {
            const upcomingDropdown = document.getElementById('upcoming-campaigns-dropdown');
            const upcomingBtn = document.getElementById('upcoming-campaigns-btn');
            
            if (upcomingDropdown && upcomingBtn && !upcomingDropdown.contains(event.target) && !upcomingBtn.contains(event.target)) {
                upcomingDropdown.style.display = 'none';
            }

            const pausedDropdown = document.getElementById('paused-campaigns-dropdown');
            const pausedBtn = document.getElementById('paused-campaigns-btn');
            
            if (pausedDropdown && pausedBtn && !pausedDropdown.contains(event.target) && !pausedBtn.contains(event.target)) {
                pausedDropdown.style.display = 'none';
            }
        });

        // Funciones para el slider de delay
        function updateSliderValue() {
            const slider = document.getElementById('delay-slider');
            const input = document.getElementById('delay-slider-value');
            input.value = parseInt(slider.value);
            
            // Actualizar el gradiente del slider
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }

        function updateSliderFromInput() {
            const slider = document.getElementById('delay-slider');
            const input = document.getElementById('delay-slider-value');
            
            // Validar y limitar el valor
            let value = parseInt(input.value) || 1;
            if (value < 1) value = 1;
            if (value > 60) value = 60;
            
            input.value = value;
            slider.value = value;
            
            // Actualizar el gradiente del slider
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }

        function toggleDelayMode() {
            const mode = document.querySelector('input[name="delay-mode"]:checked').value;
            const customOption = document.getElementById('custom-option');
            const sliderOption = document.getElementById('slider-option');
            const delaySlider = document.getElementById('delay-slider');
            const delaySliderValue = document.getElementById('delay-slider-value');
            
            // Mostrar/ocultar opciones seg√∫n el modo seleccionado
            if (mode === 'custom') {
                customOption.style.display = 'block';
                sliderOption.style.display = 'flex';
                // Deshabilitar el slider cuando est√° en modo personalizado
                delaySlider.disabled = true;
                delaySliderValue.disabled = true;
                sliderOption.style.opacity = '0.5';
                sliderOption.style.pointerEvents = 'none';
            } else if (mode === 'slider') {
                customOption.style.display = 'none';
                sliderOption.style.display = 'flex';
                // Habilitar el slider cuando est√° en modo fijo
                delaySlider.disabled = false;
                delaySliderValue.disabled = false;
                sliderOption.style.opacity = '1';
                sliderOption.style.pointerEvents = 'auto';
            } else {
                customOption.style.display = 'none';
                sliderOption.style.display = 'none';
            }
        }

        // Funciones para el slider de tama√±o de lote
        function updateBatchSizeValue() {
            const slider = document.getElementById('batch-size-slider');
            const input = document.getElementById('batch-size');
            input.value = parseInt(slider.value);
            
            // Actualizar el gradiente del slider
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }

        function updateBatchSizeFromInput() {
            const slider = document.getElementById('batch-size-slider');
            const input = document.getElementById('batch-size');
            
            // Validar y limitar el valor
            let value = parseInt(input.value) || 10;
            if (value < 10) value = 10;
            if (value > 50) value = 50;
            
            input.value = value;
            slider.value = value;
            
            // Actualizar el gradiente del slider
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }

        // Funciones para el slider de pausa entre lotes
        function updateBatchDelayValue() {
            const slider = document.getElementById('batch-delay-slider');
            const input = document.getElementById('batch-delay');
            input.value = parseInt(slider.value);
            
            // Actualizar el gradiente del slider
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }

        function updateBatchDelayFromInput() {
            const slider = document.getElementById('batch-delay-slider');
            const input = document.getElementById('batch-delay');
            
            // Validar y limitar el valor
            let value = parseInt(input.value) || 5;
            if (value < 5) value = 5;
            if (value > 50) value = 50;
            
            input.value = value;
            slider.value = value;
            
            // Actualizar el gradiente del slider
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
        }
    </script>
</body>
</html>
